<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Hexo</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hexo</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/05/18/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/18/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E6%80%BB%E7%BB%93/" class="post-title-link" itemprop="url">编译原理总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-05-18 23:36:48" itemprop="dateCreated datePublished" datetime="2022-05-18T23:36:48+08:00">2022-05-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-05-19 00:46:39" itemprop="dateModified" datetime="2022-05-19T00:46:39+08:00">2022-05-19</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="知识点总结"><a href="#知识点总结" class="headerlink" title="知识点总结"></a>知识点总结</h2><h3 id="杂乱"><a href="#杂乱" class="headerlink" title="杂乱"></a>杂乱</h3><h4 id="消除左递归的方法"><a href="#消除左递归的方法" class="headerlink" title="消除左递归的方法"></a>消除左递归的方法</h4><p><img src="/2022/05/18/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E6%80%BB%E7%BB%93/image-20220512192836269.png" alt="image-20220512192836269" style="zoom:50%;"></p>
<p><img src="/2022/05/18/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E6%80%BB%E7%BB%93/image-20220512192935922.png" alt="image-20220512192935922" style="zoom:50%;"></p>
<h4 id="句柄"><a href="#句柄" class="headerlink" title="句柄"></a>句柄</h4><p><strong>句柄</strong>：句型的最左直接短语</p>
<h4 id="LL文法判断"><a href="#LL文法判断" class="headerlink" title="LL文法判断"></a>LL文法判断</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">当且仅当G的任意两个具有相同左部的产生式A → α | β 满足下面的条件：</span><br><span class="line">不存在终结符a使得α 和β都能够推导出以a开头的串</span><br><span class="line">α 和β至多有一个能推导出ε </span><br><span class="line">如果 β -&gt;* ε，则FIRST (α)∩FOLLOW(A) =Φ；</span><br><span class="line">如果 α -&gt;* ε，则FIRST (β)∩FOLLOW(A) =Φ；</span><br></pre></td></tr></table></figure>
<h4 id="LR四种文法的判断"><a href="#LR四种文法的判断" class="headerlink" title="LR四种文法的判断"></a>LR四种文法的判断</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">关系：LR(0)&lt;SLR(1)&lt;LALR(1)&lt;LR(1)</span><br></pre></td></tr></table></figure>
<p>1.判断LR(0)文法：<br>看项目中是否有归约-归约和移进-归约冲突。<br>如果无冲突则是LR(0)文法（如果是LR(0)文法则四种都是）；如果有冲突则不是LR(0)文法。（就要向下判断）</p>
<p>2.判断SLR(1)文法：<br>a:DFA中存在冲突项目（归约-归约，归约-移进）<br>b:{a1,a2,…,an},FOLLOW(B1),FOLLOW(B2)两两互不相交，（交集=空集）时是SLR(1)项目。<br>【也就是说，同时满足两个条件才是SLR（1）文法】</p>
<p>若不是再向下判断。</p>
<p>3.判断LR(1)文法：<br>构造带向前搜索符的DFA，无归约-归约冲突则是LR(1)文法。</p>
<p>【此处意思是如果有向前搜索符还有冲突的话就不是LR（1）文法，就要再向下判断】</p>
<p>4.判断LALR(1)文法：<br>合并同心集后无（归约-归约）冲突（在之前的基础上）<br>（核相同，向前搜索符不同）</p>
<p>（B-&gt;a,a<br>B-&gt;a,a|b<br>同心集）</p>
<p><strong>LR即指LR(1)</strong></p>
<h4 id="四元式知识点"><a href="#四元式知识点" class="headerlink" title="四元式知识点"></a>四元式知识点</h4><p><img src="/2022/05/18/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E6%80%BB%E7%BB%93/image-20220518170348404.png" alt="image-20220518170348404" style="zoom:50%;"></p>
<p><img src="/2022/05/18/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E6%80%BB%E7%BB%93/image-20220518170539086.png" alt="image-20220518170539086" style="zoom:50%;"></p>
<p><img src="/2022/05/18/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E6%80%BB%E7%BB%93/image-20220518170614471.png" alt="image-20220518170614471" style="zoom:50%;"></p>
<h4 id="一些函数"><a href="#一些函数" class="headerlink" title="一些函数"></a>一些函数</h4><p>赋值语句的翻译</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">newtemp( )：生成一个新的临时变量t，返回t的地址</span><br><span class="line">gen(code)：生成三地址指令code</span><br><span class="line">lookup(name)：查询符号表返回name 对应的记录</span><br></pre></td></tr></table></figure>
<p>数组引用的翻译</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">L的综合属性</span><br><span class="line">L.type：L生成的数组元素的类型</span><br><span class="line">L.offset：指示一个临时变量，该临时变量用于累加公式中的ij × wj项，从而计算数组元素的偏移量</span><br><span class="line">L.array：数组名在符号表的入口地址</span><br></pre></td></tr></table></figure>
<p>控制语句的翻译</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">继承属性</span><br><span class="line">B.true：是一个地址，该地址用来存放当B为真时控制流转向的指令的标号</span><br><span class="line">B.false：是一个地址，该地址用来存放当B为假时控制流转向的指令的标号</span><br><span class="line">S.next：是一个地址，该地址用来存放紧跟在S代码之后执行的指令(S的后继指令)的标号</span><br></pre></td></tr></table></figure>
<p><strong>回填</strong></p>
<p>非终结符B的综合属性</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">B.truelist：指向一个包含跳转指令的列表，这些指令最终获得的目标标号就是当B为真时控制流应该转向的指令的标号</span><br><span class="line">B.falselist：指向一个包含跳转指令的列表，这些指令最终获得的目标标号就是当B为假时控制流应该转向的指令的标号</span><br></pre></td></tr></table></figure>
<p>函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">makelist( i )</span><br><span class="line">创建一个只包含i的列表，i是跳转指令的标号，函数返回指向新创建的列表的指针</span><br><span class="line">merge( p1, p2 )</span><br><span class="line">将 p1 和 p2 指向的列表进行合并，返回指向合并后的列表的指针</span><br><span class="line">backpatch( p, i )</span><br><span class="line">将 i 作为目标标号插入到 p所指列表中的各指令中</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nextquad：即将生成的下一条指令的标号</span><br></pre></td></tr></table></figure>
<h4 id="优化方法"><a href="#优化方法" class="headerlink" title="优化方法"></a>优化方法</h4><p><img src="/2022/05/18/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E6%80%BB%E7%BB%93/image-20220517011523873.png" alt="image-20220517011523873" style="zoom: 25%;"></p>
<h4 id="NFA到DFA的转换"><a href="#NFA到DFA的转换" class="headerlink" title="NFA到DFA的转换"></a>NFA到DFA的转换</h4><p><img src="/2022/05/18/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E6%80%BB%E7%BB%93/image-20220114100302890.png" alt="image-20220114100302890" style="zoom: 25%;"></p>
<p><img src="/2022/05/18/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E6%80%BB%E7%BB%93/image-20220114100719876.png" alt="image-20220114100719876" style="zoom: 25%;"></p>
<h4 id="词法分析"><a href="#词法分析" class="headerlink" title="词法分析"></a>词法分析</h4><p>词法分析阶段可检测错误的类型：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">单词拼写错误</span><br><span class="line">非法字符</span><br></pre></td></tr></table></figure>
<h4 id="语法分析"><a href="#语法分析" class="headerlink" title="语法分析"></a>语法分析</h4><p>最左规约称为规范规约，而最右推导相应的称为规范推导。</p>
<p>LL错误恢复：恐慌模式</p>
<p>LR错误恢复：恐慌模式错误恢复；短语层次错误恢复</p>
<h4 id="语法制导翻译"><a href="#语法制导翻译" class="headerlink" title="语法制导翻译"></a>语法制导翻译</h4><p>这两种情况下，SDT可在语法分析过程中实现</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">基本文法可以使用LR分析技术，且SDD是S属性的</span><br><span class="line">基本文法可以使用LL分析技术，且SDD是L属性的</span><br></pre></td></tr></table></figure>
<p>给定一个以LL文法为基础的L-SDD，可以修改这个文法，并在LR语法分析过程中计算这个新文法之上的SDD</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">给定一个以LL文法为基础的L-属性定义，可以修改这个文法，并在LR语法分析过程中计算这个新文法之上的SDD</span><br><span class="line">首先构造SDT，在各个非终结符之前放置语义动作来计算它的继承属性， 并在产生式后端放置语义动作计算综合属性</span><br><span class="line">对每个内嵌的语义动作，向文法中引入一个标记非终结符来替换它。每个这样的位置都有一个不同的标记，并且对于任意一个标记M都有一个产生式M→ε</span><br><span class="line">如果标记非终结符M在某个产生式A→α&#123;a&#125;β中替换了语义动作a，对a进行修改得到a&#x27; ，并且将a&#x27;关联到M→ε 上。动作a&#x27;</span><br><span class="line">(a) 将动作a需要的A或α中符号的任何属性作为M的继承属性进行复制</span><br><span class="line">(b) 按照a中的方法计算各个属性，但是将计算得到的这些属性作为M的综合属性</span><br></pre></td></tr></table></figure>
<h3 id="中间代码生成"><a href="#中间代码生成" class="headerlink" title="中间代码生成"></a>中间代码生成</h3><h4 id="类型表达式"><a href="#类型表达式" class="headerlink" title="类型表达式"></a>类型表达式</h4><p><img src="/2022/05/18/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E6%80%BB%E7%BB%93/image-20220514095400390.png" alt="image-20220514095400390" style="zoom: 25%;"></p>
<h4 id="控制流语句SDT编写要点"><a href="#控制流语句SDT编写要点" class="headerlink" title="控制流语句SDT编写要点"></a>控制流语句SDT编写要点</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">分析每一个非终结符之前</span><br><span class="line">先计算继承属性</span><br><span class="line">再观察代码结构图中该非终结符对应的方框顶部是否有导入箭头。如果有，调用label( )函数</span><br><span class="line">上一个代码框执行完不顺序执行下一个代码框时，生成一条显式跳转指令</span><br><span class="line">有自下而上的箭头时，设置begin属性。且定义后直接调用label( )函数绑定地址</span><br></pre></td></tr></table></figure>
<h3 id="运行存储分配"><a href="#运行存储分配" class="headerlink" title="运行存储分配"></a>运行存储分配</h3><h4 id="活动记录的一般形式"><a href="#活动记录的一般形式" class="headerlink" title="活动记录的一般形式"></a>活动记录的一般形式</h4><p><img src="/2022/05/18/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E6%80%BB%E7%BB%93/image-20220514194518053.png" alt="image-20220514194518053" style="zoom:25%;"></p>
<h4 id="静态存储分配"><a href="#静态存储分配" class="headerlink" title="静态存储分配"></a>静态存储分配</h4><p>顺序分配法<img src="/2022/05/18/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E6%80%BB%E7%BB%93/image-20220514195326335.png" alt="image-20220514195326335" style="zoom:25%;"></p>
<p>层次分配法<img src="/2022/05/18/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E6%80%BB%E7%BB%93/image-20220514195613542.png" alt="image-20220514195613542" style="zoom:25%;"></p>
<h4 id="栈式存储分配"><a href="#栈式存储分配" class="headerlink" title="栈式存储分配"></a>栈式存储分配</h4><p>活动树</p>
<p>调用序列与返回序列</p>
<p><img src="/2022/05/18/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E6%80%BB%E7%BB%93/image-20220514203627726.png" alt="image-20220514203627726" style="zoom:25%;"></p>
<p><img src="/2022/05/18/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E6%80%BB%E7%BB%93/image-20220514203641791.png" alt="image-20220514203641791" style="zoom:25%;"></p>
<p><img src="/2022/05/18/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E6%80%BB%E7%BB%93/image-20220514203739336.png" alt="image-20220514203739336" style="zoom:25%;"></p>
<h3 id="代码优化"><a href="#代码优化" class="headerlink" title="代码优化"></a>代码优化</h3><p>如果表达式x op y先前已被计算过，并且从先前的计算到现在，x op y中变量的值没有改变，那么x op y的这次出现就称为<strong>公共子表达式</strong></p>
<p> <strong>复制传播</strong>：在复制语句x = y之后尽可能地用y代替x</p>
<p>对于一个变量x ，如果存在一个正的或负的常数c使得每次x被赋值时它的值总增加c ，那么x就称为<strong>归纳变量</strong></p>
<h4 id="DAG"><a href="#DAG" class="headerlink" title="DAG"></a>DAG</h4><p>数组元素赋值<img src="/2022/05/18/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E6%80%BB%E7%BB%93/image-20220515144738742.png" alt="image-20220515144738742" style="zoom:25%;"></p>
<h4 id="数据流分析"><a href="#数据流分析" class="headerlink" title="数据流分析"></a>数据流分析</h4><p><strong>到达定值分析</strong></p>
<p>正常</p>
<p>作用：</p>
<p>循环不变计算的检测</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">如果循环中含有赋值x=y+z ，而y和z所有可能的定值都在循环外面(包括y或z是常数的特殊情况) ，那么y+z就是循环不变计算</span><br></pre></td></tr></table></figure>
<p>常量合并</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">如果对变量x的某次使用只有一个定值可以到达，并且该定值把一个常量赋给x ，那么可以简单地把x替换为该常量</span><br></pre></td></tr></table></figure>
<p>ud链<img src="/2022/05/18/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E6%80%BB%E7%BB%93/image-20220515160301603.png" alt="image-20220515160301603" style="zoom:25%;"></p>
<p><strong>活跃变量分析</strong></p>
<p><strong>活跃变量</strong>：对于变量x和程序点p，如果在流图中沿着从p开始的某条路径会引用变量x在p点的值，则称变量x在点p是活跃(live)的，否则称变量x在点p不活跃(dead)</p>
<p>逆向分析</p>
<p>用途：</p>
<p>删除无用赋值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">无用赋值：如果x在点p的定值在基本块内所有后继点都不被引用，且x在基本块出口之后又是不活跃的，那么x在点p的定值就是无用的</span><br></pre></td></tr></table></figure>
<p>为基本块分配寄存器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">如果所有寄存器都被占用，并且还需要申请一个寄存器，则应该考虑使用已经存放了死亡值的寄存器，因为这个值不需要保存到内存</span><br><span class="line"> 如果一个值在基本块结尾处是死的就不必在结尾处保存这个值</span><br></pre></td></tr></table></figure>
<p>du链<img src="/2022/05/18/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E6%80%BB%E7%BB%93/image-20220515173505087.png" alt="image-20220515173505087" style="zoom:25%;"></p>
<p><strong>可用表达式分析</strong></p>
<p>概念：如果从流图的首节点到达程序点 p的每条路径都对表达式x op y进行计算，并且从最后一个这样的计算到点p之间没有再次对x或y定值，那么表达式x op y在点 p是可用的</p>
<p>初始化时出enter外每个out都是全集</p>
<p>用途：</p>
<p>消除全局公共子表达式</p>
<p>进行复制传播</p>
<h3 id="代码生成"><a href="#代码生成" class="headerlink" title="代码生成"></a>代码生成</h3><p>主要任务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">指令选择</span><br><span class="line">寄存器分配（allocation）和指派（assignment）</span><br><span class="line">指令排序</span><br></pre></td></tr></table></figure>
<h2 id="题目总结"><a href="#题目总结" class="headerlink" title="题目总结"></a>题目总结</h2><p>词素分析</p>
<p>符号表</p>
<p>递归的预测分析</p>
<p>非递归的预测分析</p>
<p>设计SDD</p>
<p>改写SDT</p>
<p>递归的翻译</p>
<p>非递归的翻译</p>
<p>活动记录</p>
<p>嵌套深度</p>
<p>找自然循坏</p>
<p>全局优化</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/05/12/test/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/12/test/" class="post-title-link" itemprop="url">test</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-05-12 19:59:27 / Modified: 20:33:35" itemprop="dateCreated datePublished" datetime="2022-05-12T19:59:27+08:00">2022-05-12</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h2><p><img src="/2022/05/12/test/QQ图片20220512202816.png" alt="QQ图片20220512202816"></p>
<p>现象如图所示，会一直打印A。</p>
<p>在执行时，追踪IDT表，发现表中每一项第四位的值发生了变化。</p>
<p><img src="/2022/05/12/test/QQ图片20220512203227.png" alt="QQ图片20220512203227"></p>
<p>在IDT表初始化后，其所有描述表的第四位的值均为ignore_int首第四位值，即0x114。</p>
<p>在修改的程序后，每次eax都会多执行一条+2的指令。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/05/08/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%BC%95%E5%AF%BC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/08/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%BC%95%E5%AF%BC/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-05-08 19:58:05" itemprop="dateCreated datePublished" datetime="2022-05-08T19:58:05+08:00">2022-05-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-05-10 00:20:55" itemprop="dateModified" datetime="2022-05-10T00:20:55+08:00">2022-05-10</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="操作系统的引导"><a href="#操作系统的引导" class="headerlink" title="操作系统的引导"></a>操作系统的引导</h1><h2 id="完成-bootsect-s-的屏幕输出功能"><a href="#完成-bootsect-s-的屏幕输出功能" class="headerlink" title="完成 bootsect.s 的屏幕输出功能"></a>完成 bootsect.s 的屏幕输出功能</h2><p>关键代码如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">! 文件：bootsect.s</span><br><span class="line">entry _start</span><br><span class="line">_start:</span><br><span class="line">    mov ah,#0x03</span><br><span class="line">    xor bh,bh</span><br><span class="line">    int 0x10</span><br><span class="line">    mov cx,#25</span><br><span class="line">    mov bx,#0x0007</span><br><span class="line">    mov bp,#msg1</span><br><span class="line">    mov ax,#0x07c0</span><br><span class="line">    mov es,ax</span><br><span class="line">    mov ax,#0x1301</span><br><span class="line">    int 0x10</span><br><span class="line">inf_loop:</span><br><span class="line">    jmp inf_loop</span><br><span class="line">msg1:</span><br><span class="line">    .byte   13,10</span><br><span class="line">    .ascii &quot;LKJos is running...&quot;</span><br><span class="line">    .byte   13,10,13,10</span><br><span class="line">.org 510</span><br><span class="line">boot_flag:</span><br><span class="line">    .word   0xAA55</span><br></pre></td></tr></table></figure>
<p>我们修改的字符为19个，再加上前后一共3个回车加换行，所以总共25个字符。</p>
<p>将 .org 508 修改为 .org 510，是因为这里不需要 root_dev: .word ROOT_DEV，为了保证 boot_flag 一定在最后两个字节，所以要修改 .org。</p>
<p>执行下面两个命令编译和链接 bootsect.s</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ as86 -0 -a -o bootsect.o bootsect.s</span><br><span class="line">$ ld86 -0 -s -o bootsect bootsect.o</span><br></pre></td></tr></table></figure>
<p>需要留意的文件是 <code>bootsect</code> 的文件大小是 <code>544</code> 字节，而引导程序必须要正好占用一个磁盘扇区，即 <code>512</code> 个字节。 造成多了 <code>32</code> 个字节的原因是 <code>ld86</code> 产生的是 <code>Minix</code> 可执行文件格式， 这样的可执行文件处理文本段、数据段等部分以外，还包括一个 <code>Minix</code> 可执行文件头部。</p>
<p>去掉32字节的头部文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dd bs=1 if=bootsect of=Image skip=32</span><br></pre></td></tr></table></figure>
<p>接下来进行拷贝，并且run</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 当前的工作路径为 /common/linux-0.11/boot/</span><br><span class="line"># 将刚刚生成的 Image 复制到 linux-0.11 目录下</span><br><span class="line">$ cp ./Image ../Image</span><br><span class="line"># 执行run 脚本</span><br><span class="line">$ ../../run</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>注：由于我执行run的时候有些许问题，所以我对于目录结构进行了修改。</p>
<p>效果如下图</p>
<p><img src="/2022/05/08/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%BC%95%E5%AF%BC/image-20220508200758526.png" alt="image-20220508200758526"></p>
<h2 id="bootsect-s-读入-setup-s"><a href="#bootsect-s-读入-setup-s" class="headerlink" title="bootsect.s 读入 setup.s"></a>bootsect.s 读入 setup.s</h2><p>首先编写一个 setup.s，该 setup.s 可以就直接拷贝前面的 bootsect.s，然后将其中的显示的信息改为：“Now we are in SETUP”。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">entry _start</span><br><span class="line">_start:</span><br><span class="line">	mov ah,#0x03</span><br><span class="line">	xor bh,bh</span><br><span class="line">	int 0x10</span><br><span class="line">	mov cx,#25</span><br><span class="line">	mov bx,#0x0007</span><br><span class="line">	mov bp,#msg2</span><br><span class="line">	mov ax,cs				! 这里的cs其实就是这段代码的段地址</span><br><span class="line">	mov es,ax</span><br><span class="line">	mov ax,#0x1301</span><br><span class="line">	int 0x10</span><br><span class="line">inf_loop:</span><br><span class="line">	jmp inf_loop</span><br><span class="line">msg2:</span><br><span class="line">	.byte	13,10</span><br><span class="line">	.ascii	&quot;Now we are in SETUP&quot;</span><br><span class="line">	.byte	13,10,13,10</span><br><span class="line">.org 510</span><br><span class="line">boot_flag:</span><br><span class="line">	.word	0xAA55</span><br></pre></td></tr></table></figure>
<p>接下来需要编写 <code>bootsect.s</code> 中载入 <code>setup.s</code> 的关键代码,注意去掉无限循环</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">SETUPLEN=2              ! 读入的扇区数</span><br><span class="line">SETUPSEG=0x07e0         ! setup代码的段地址</span><br><span class="line">entry _start</span><br><span class="line">_start:</span><br><span class="line">    mov ah,#0x03        ! 设置功能号</span><br><span class="line">    xor bh,bh           ! 将bh置0</span><br><span class="line">    int 0x10            ! 返回行号和列号，供显示串用</span><br><span class="line">    mov cx,#25          ！要显示的字符串长度</span><br><span class="line">    mov bx,#0x0007      ! bh=0,bl=07(正常的黑底白字)</span><br><span class="line">    mov bp,#msg1        ! es:bp 要显示的字符串物理地址</span><br><span class="line">    mov ax,#0x07c0      ! 将es段寄存器置为#0x07c0</span><br><span class="line">    mov es,ax           </span><br><span class="line">    mov ax,#0x1301      ! ah=13(设置功能号),al=01(目标字符串仅仅包含字符，属性在BL中包含，光标停在字符串结尾处)</span><br><span class="line">    int 0x10            ! 显示字符串</span><br><span class="line"></span><br><span class="line">! 将setup模块从磁盘的第二个扇区开始读到0x7e00</span><br><span class="line">load_setup:</span><br><span class="line">    mov dx,#0x0000                  ! 磁头=0；驱动器号=0</span><br><span class="line">    mov cx,#0x0002                  ! 磁道=0；扇区=2</span><br><span class="line">    mov bx,#0x0200                  ! 偏移地址</span><br><span class="line">    mov ax,#0x0200+SETUPLEN         ! 设置功能号；需要读出的扇区数量</span><br><span class="line">    int 0x13                        ! 读磁盘扇区到内存</span><br><span class="line">    jnc ok_load_setup               ! CF=0(读入成功)跳转到ok_load_setup  </span><br><span class="line">    mov dx,#0x0000                  ! 如果读入失败，使用功能号ah=0x00————磁盘系统复位</span><br><span class="line">    mov ax,#0x0000</span><br><span class="line">    int 0x13</span><br><span class="line">    jmp load_setup                  ! 尝试重新读入</span><br><span class="line"></span><br><span class="line">ok_load_setup:</span><br><span class="line">    jmpi    0,SETUPSEG              ! 段间跳转指令，跳转到setup模块处(0x07e0:0000)</span><br><span class="line"></span><br><span class="line">! 字符串信息</span><br><span class="line">msg1:</span><br><span class="line">    .byte   13,10           ! 换行+回车</span><br><span class="line">    .ascii  &quot;LKJos is running...&quot;</span><br><span class="line">    .byte   13,10,13,10     ! 换行+回车</span><br><span class="line"></span><br><span class="line">! 将</span><br><span class="line">.org 510</span><br><span class="line"></span><br><span class="line">! 启动盘具有有效引导扇区的标志。仅供BIOS中的程序加载引导扇区时识别使用。它必须位于引导扇区的最后两个字节中</span><br><span class="line">boot_flag:</span><br><span class="line">    .word   0xAA55</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>效果如下图</p>
<p><img src="/2022/05/08/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%BC%95%E5%AF%BC/image-20220508210219587.png" alt="image-20220508210219587"></p>
<p>需要修改build.c，并且删除同目录下的 <code>hdc-0.11.img.lock</code> 即可。</p>
<h2 id="setup-s-获取基本硬件参数"><a href="#setup-s-获取基本硬件参数" class="headerlink" title="setup.s 获取基本硬件参数"></a>setup.s 获取基本硬件参数</h2><p><code>setup.s</code> 将获得硬件参数放在内存的 <code>0x90000</code> 处。原版 <code>setup.s</code> 中已经完成了光标位置、内存大小、显存大小、显卡参数、第一和第二硬盘参数的保存。</p>
<p>用 <code>ah=#0x03</code> 调用 <code>0x10</code> 中断可以读出光标的位置，用 <code>ah=#0x88</code> 调用 <code>0x15</code> 中断可以读出内存的大小。 有些硬件参数的获取要稍微复杂一些，如磁盘参数表。在 <code>PC</code> 机中 <code>BIOS</code> 设定的中断向量表中 <code>int 0x41</code> 的中断向量位置( <code>4*0x41 = 0x0000:0x0104</code> )存放的并不是中断程序的地址，而是第一个硬盘的基本参数表。 第二个硬盘的基本参数表入口地址存于 <code>int 0x46</code> 中断向量位置处。每个硬盘参数表有 <code>16</code> 个字节大小。</p>
<p>在PC机中BIOS设定的中断向量表中int 0x41的中断向量位置存放的并不是中断程序的地址,而是第一个硬盘的基本参数表。对于100%兼容的BIOS来说,这里存放着硬盘参数表阵列的首地址0xF000:0E401，第二个硬盘的基本参数表入口地址存于int 0x46中断向量位置处.每个硬盘参数表有16个字节大小.</p>
<p>这段话是重点，磁盘参数就存放在以0x0000:0x0104为首地址的单元中只存了4个字节，里面存放的是磁盘参数表的偏移地址和段地址，也就是上文所说这里存放着硬盘参数表阵列的首地址0xF000:0E401。</p>
<p>以十六进制方式显示比较简单。这是因为十六进制与二进制有很好的对应关系（每 4 位二进制数和 1 位十六进制数存在一一对应关系），显示时只需将原二进制数每 4 位划成一组，按组求对应的 ASCII 码送显示器即可。ASCII 码与十六进制数字的对应关系为：0x30 ～ 0x39 对应数字 0 ～ 9，0x41 ～ 0x46 对应数字 a ～ f。从数字 9 到 a，其 ASCII 码间隔了 7h，这一点在转换时要特别注意。为使一个十六进制数能按高位到低位依次显示，实际编程中，需对 bx 中的数每次循环左移一组（4 位二进制），然后屏蔽掉当前高 12 位，对当前余下的 4 位（即 1 位十六进制数）求其 ASCII 码，要判断它是 0 ～ 9 还是 a ～ f，是前者则加 0x30 得对应的 ASCII 码，后者则要加 0x37 才行，最后送显示器输出。以上步骤重复 4 次，就可以完成 bx 中数以 4 位十六进制的形式显示出来。</p>
<p>如下图：</p>
<p><img src="/2022/05/08/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%BC%95%E5%AF%BC/image-20220508215057266.png" alt="image-20220508215057266"></p>
<p>代码如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br></pre></td><td class="code"><pre><span class="line">! 文件setup.s</span><br><span class="line">INITSEG = 0x9000</span><br><span class="line"></span><br><span class="line">entry _start</span><br><span class="line">_start:</span><br><span class="line">! 在显示字符串之前必须先获取当前光标的位置，这样就可以把字符串显示到当前光标处了</span><br><span class="line">    mov    ah,#0x03</span><br><span class="line">    xor    bh,bh</span><br><span class="line">    int    0x10</span><br><span class="line">    </span><br><span class="line">! 利用10号中断的13号功能打印字符串&quot;Now we are in SETUP.&quot;</span><br><span class="line">    mov    cx,#26</span><br><span class="line">    mov    bx,#0x0007</span><br><span class="line">    mov    bp,#msg1</span><br><span class="line">    mov     ax,cs</span><br><span class="line">    mov    es,ax</span><br><span class="line">    mov    ax,#0x1301</span><br><span class="line">    int    0x10</span><br><span class="line"></span><br><span class="line">! 下面开始读取一些硬件参数</span><br><span class="line"></span><br><span class="line">    ! 读入光标位置信息，保存到0x90000处</span><br><span class="line">    mov    ax,#INITSEG</span><br><span class="line">    mov    ds,ax</span><br><span class="line">    mov    ah,#0x03</span><br><span class="line">    xor    bh,bh</span><br><span class="line">    int    0x10</span><br><span class="line">    mov    [0],ds</span><br><span class="line"></span><br><span class="line">    ! 读入内存大小位置信息，保存到0x90002处</span><br><span class="line">    mov    ah,#0x88</span><br><span class="line">    int    0x15</span><br><span class="line">    mov    [2],ax</span><br><span class="line"></span><br><span class="line">    ! 从0x41处拷贝16个字节（磁盘参数表）到0x90004处</span><br><span class="line">    mov    ax,#0x0000</span><br><span class="line">    mov    ds,ax</span><br><span class="line">    lds    si,[4*0x41]</span><br><span class="line">    mov    ax,#INITSEG</span><br><span class="line">    mov    es,ax</span><br><span class="line">    mov    di,#0x0004</span><br><span class="line">    mov    cx,#0x10</span><br><span class="line">    rep       ! 重复16次</span><br><span class="line">    movsb</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">! 先打印光标位置</span><br><span class="line">    ! 打印字符串之前要先读取光标位置，将字符串打印到当前光标处</span><br><span class="line">    mov    ah,#0x03</span><br><span class="line">    xor    bh,bh</span><br><span class="line">    int    0x10</span><br><span class="line"></span><br><span class="line">    ! 打印字符串 &quot;Cursor POS:&quot;</span><br><span class="line">    mov    cx,#11</span><br><span class="line">    mov    bx,#0x0007</span><br><span class="line">    mov    ax,cs</span><br><span class="line">    mov    es,ax</span><br><span class="line">    mov    bp,#msg2</span><br><span class="line">    mov    ax,#0x1301</span><br><span class="line">    int    0x10    </span><br><span class="line">    </span><br><span class="line">    ! 调用打印函数，打印光标位置</span><br><span class="line">    mov    ax,#0x9000</span><br><span class="line">    mov    ds,ax</span><br><span class="line">    mov    dx,0x0</span><br><span class="line">    call    print_hex</span><br><span class="line">    call    print_nl</span><br><span class="line"></span><br><span class="line">! 打印内存大小</span><br><span class="line">    ! 打印字符串&quot;Memory SIZE:&quot;</span><br><span class="line">    mov    ah,#0x03</span><br><span class="line">    xor    bh,bh</span><br><span class="line">    int    0x10    ! 读取光标位置</span><br><span class="line"></span><br><span class="line">    mov    cx,#12</span><br><span class="line">    mov    bx,#0x0007</span><br><span class="line">    mov    ax,cs</span><br><span class="line">    mov    es,ax</span><br><span class="line">    mov    bp,#msg3</span><br><span class="line">    mov    ax,#0x1301</span><br><span class="line">    int    0x10    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    ! 调用打印函数，打印内存大小信息</span><br><span class="line">    mov    ax,#0x9000    </span><br><span class="line">    mov    ds,ax</span><br><span class="line">    mov    dx,0x2</span><br><span class="line">    call     print_hex</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    ! 打印字符串&quot;KB&quot;</span><br><span class="line">    mov    ah,#0x03</span><br><span class="line">    xor    bh,bh</span><br><span class="line">    int    0x10    ! 读取光标位置    </span><br><span class="line">    </span><br><span class="line">    mov    cx,#2</span><br><span class="line">    mov    bx,#0x0007</span><br><span class="line">    mov    ax,cs</span><br><span class="line">    mov    es,ax</span><br><span class="line">    mov    bp,#msg4</span><br><span class="line">    mov    ax,#0x1301</span><br><span class="line">    int    0x10    </span><br><span class="line">    call    print_nl    </span><br><span class="line"></span><br><span class="line">!打印柱面数</span><br><span class="line">    ! 打印字符串&quot;Cyls&quot;</span><br><span class="line">    mov    ah,#0x03</span><br><span class="line">    xor    bh,bh</span><br><span class="line">    int    0x10    ! 读取光标位置</span><br><span class="line"></span><br><span class="line">    mov    cx,#5</span><br><span class="line">    mov    bx,#0x0007</span><br><span class="line">    mov    ax,cs</span><br><span class="line">    mov    es,ax</span><br><span class="line">    mov    bp,#msg5</span><br><span class="line">    mov    ax,#0x1301</span><br><span class="line">    int    0x10    </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    ! 调用打印函数打印磁盘柱面数</span><br><span class="line">    mov    ax,#0x9000    </span><br><span class="line">    mov    ds,ax</span><br><span class="line">    mov    dx,0x4</span><br><span class="line">    call    print_hex</span><br><span class="line">    call    print_nl</span><br><span class="line"></span><br><span class="line">! 打印磁头数</span><br><span class="line">    ! 打印字符串&quot;Heads:&quot;</span><br><span class="line">    mov    ah,#0x03</span><br><span class="line">    xor    bh,bh</span><br><span class="line">    int    0x10    ! 读取光标位置</span><br><span class="line"></span><br><span class="line">    mov    cx,#6</span><br><span class="line">    mov    bx,#0x0007</span><br><span class="line">    mov    ax,cs</span><br><span class="line">    mov    es,ax</span><br><span class="line">    mov    bp,#msg6</span><br><span class="line">    mov    ax,#0x1301</span><br><span class="line">    int    0x10    </span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    ! 调用打印函数打印磁盘磁头数</span><br><span class="line">    mov    ax,#0x9000    </span><br><span class="line">    mov    ds,ax</span><br><span class="line">    mov    dx,0x6</span><br><span class="line">    call    print_hex</span><br><span class="line">    call    print_nl</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">! 打印每磁道扇区数</span><br><span class="line">    ! 打印字符串&quot;sectors&quot;</span><br><span class="line">    mov    ah,#0x03</span><br><span class="line">    xor    bh,bh</span><br><span class="line">    int    0x10    ! 读取光标位置</span><br><span class="line"></span><br><span class="line">    mov    cx,#8</span><br><span class="line">    mov    bx,#0x0007</span><br><span class="line">    mov    ax,cs</span><br><span class="line">    mov    es,ax</span><br><span class="line">    mov    bp,#msg7</span><br><span class="line">    mov    ax,#0x1301</span><br><span class="line">    int    0x10    </span><br><span class="line"></span><br><span class="line">    ! 调用打印函数打印扇区数</span><br><span class="line">    mov    ax,#0x9000    </span><br><span class="line">    mov    ds,ax</span><br><span class="line">    mov    dx,0x12</span><br><span class="line">    call    print_hex</span><br><span class="line">    call    print_nl</span><br><span class="line"></span><br><span class="line">Inf_loop:</span><br><span class="line">    jmp Inf_loop    ! 无限循环</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">! print_hex函数：将一个数字转换为ascii码字符，并打印到屏幕上</span><br><span class="line">! 参数值：dx</span><br><span class="line">! 返回值：无</span><br><span class="line">print_hex:</span><br><span class="line">    mov    cx,#4            ! 要打印4个十六进制数字,故循环4次</span><br><span class="line">print_digit:</span><br><span class="line">    rol    dx,#4            ! 循环以使低4比特用上 !! 取dx的高4比特移到低4比特处</span><br><span class="line">    mov    ax,#0xe0f        ! ah = 请求的功能值，al = 半字节(4个比特)掩码</span><br><span class="line">    and    al,dl            ! 取dl的低4比特值</span><br><span class="line">    add    al,#0x30        ! 给al数字加上十六进制0x30</span><br><span class="line">    cmp    al,#0x3a    </span><br><span class="line">    jl    outp            ! 如果是一个不大于十的数字</span><br><span class="line">    add    al,#0x07    ! 如果是a～f，要多加7</span><br><span class="line">outp:</span><br><span class="line">    int    0x10</span><br><span class="line">    loop    print_digit    ! 用loop重复4次</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line">! 打印回车换行</span><br><span class="line">print_nl:</span><br><span class="line">    mov    ax,#0xe0d</span><br><span class="line">    int    0x10</span><br><span class="line">    mov    al,#0xa</span><br><span class="line">    int    0x10</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line">msg1:</span><br><span class="line">    .byte 13,10</span><br><span class="line">    .ascii &quot;Now we are in SETUP.&quot;</span><br><span class="line">    .byte 13,10,13,10</span><br><span class="line"></span><br><span class="line">msg2:</span><br><span class="line">    .ascii &quot;Cursor POS:&quot;</span><br><span class="line"></span><br><span class="line">msg3:    </span><br><span class="line">    .ascii &quot;Memory SIZE:&quot;</span><br><span class="line"></span><br><span class="line">msg4:</span><br><span class="line">    .ascii &quot;KB&quot;</span><br><span class="line"></span><br><span class="line">msg5:    </span><br><span class="line">    .ascii &quot;Cyls:&quot;</span><br><span class="line"></span><br><span class="line">msg6:</span><br><span class="line">    .ascii &quot;Heads:&quot;</span><br><span class="line"></span><br><span class="line">msg7:</span><br><span class="line">    .ascii &quot;Sectors:&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.org 510</span><br><span class="line">boot_flag:</span><br><span class="line">    .word 0xAA55</span><br></pre></td></tr></table></figure>
<h2 id="问题解答"><a href="#问题解答" class="headerlink" title="问题解答"></a>问题解答</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">当PC的电源打开后，80x86结构的CPU将自动进入实模式，并从地址0xFFFF0开始自动执行程序代码，这个地址通常是ROM—BIOS中的地址。PC机的BIOS将执行某些系统的检测，并在物理地址0处开始初始化中断向量。此后将启动设备的第一个扇区512字节读入内存绝对地址0x7C00处。因为当时system模块的长度不会超过0x80000字节大小512KB，所以bootsect程序把system模块读入物理地址0x10000开始位置处时并不会覆盖在0x90000处开始的bootsect和setup模块，多此一举的是system模块移到内存中相对靠后的位置，以便加载系统主模块。解决方案是在保证操作系统启动引导成功的前提下尽量扩大ROM—BIOS的内存寻址范围。</span><br></pre></td></tr></table></figure>
<h2 id="知识点记录"><a href="#知识点记录" class="headerlink" title="知识点记录"></a>知识点记录</h2><h3 id="数据寄存器"><a href="#数据寄存器" class="headerlink" title="数据寄存器"></a>数据寄存器</h3><p><strong>AH&amp;AL=AX(accumulator)：</strong>累加寄存器，常用于运算;在乘除等指令中指定用来存放操作数，另外,所有的I/O指令都使用这一寄存器与外界设备传送数据。</p>
<p><strong>BH&amp;BL=BX(base)：</strong>基址寄存器，常用于地址索引</p>
<p><strong>CH&amp;CL=CX(count)：</strong>计数寄存器，常用于计数；常用于保存计算值，如在移位指令,循环(loop)和串处理指令中用作隐含的计数器.</p>
<p><strong>DH&amp;DL=DX(data)：</strong>数据寄存器，常用于数据传递。</p>
<p>他们的特点是，这4个16位的寄存器可以分为高8位: AH, BH, CH, DH.以及低八位：AL,BL,CL,DL。这2组8位寄存器可以分别寻址，并单独使用。</p>
<h3 id="中断知识"><a href="#中断知识" class="headerlink" title="中断知识"></a>中断知识</h3><h4 id="int-0x10"><a href="#int-0x10" class="headerlink" title="int 0x10"></a>int 0x10</h4><p><img src="/2022/05/08/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%BC%95%E5%AF%BC/image-20220509162715086.png" alt="image-20220509162715086"></p>
<p>注意，这里ah要先有值，代表内部子程序的编号</p>
<p>功能号ah=0x03，作用是读取光标的位置</p>
<p>输入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bh = 页号</span><br></pre></td></tr></table></figure>
<p>返回：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ch = 扫描开始线；cl = 扫描结束线；dh = 行号；dl = 列号</span><br></pre></td></tr></table></figure>
<p>功能号ah=0x13，作用是显示字符串</p>
<p>输入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">al = 放置光标的方式及规定属性，下文 al＝1，表示目标字符串仅仅包含字符，属性在BL中包含，光标停在字符串结尾处；es:bp = 字符串起始位置；cx = 显示的字符串字符数；bh = 页号；bl = 字符属性，下文 bl = 07H，表示正常的黑底白字；dh = 行号；dl = 列号</span><br></pre></td></tr></table></figure>
<p>功能号ah=0x0e，作用是显示字符</p>
<p>输入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">al = 字符</span><br></pre></td></tr></table></figure>
<h4 id="int-0x13"><a href="#int-0x13" class="headerlink" title="int 0x13"></a>int 0x13</h4><p>在DOS等实模式操作系统下，调用INT 13h会跳转到计算机的ROM-BIOS代码中进行低级磁盘服务，对程序进行基于物理扇区的磁盘读写操作。</p>
<p>功能号ah=0x02，作用是读磁盘扇区到内存<br>输入：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>寄存器</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>ah</td>
<td>读磁盘扇区到内存</td>
</tr>
<tr>
<td>al</td>
<td>需要读出的扇区数量</td>
</tr>
<tr>
<td>ch</td>
<td>磁道</td>
</tr>
<tr>
<td>cl</td>
<td>扇区</td>
</tr>
<tr>
<td>dh</td>
<td>磁头</td>
</tr>
<tr>
<td>dl</td>
<td>驱动器</td>
</tr>
<tr>
<td>es:bx</td>
<td>数据缓冲区的地址</td>
</tr>
</tbody>
</table>
</div>
<p>返回</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ah = 出错码（00H表示无错，01H表示非法命令，02H表示地址目标未发现…）；CF为进位标志位，如果没有出错CF=0</span><br></pre></td></tr></table></figure>
<p>功能号ah=0x00，作用是磁盘系统复位</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：dl = 驱动器</span><br><span class="line">返回：如果操作成功———— C F = 0 CF=0CF=0，a h = 00 H ah=00Hah=00H</span><br></pre></td></tr></table></figure>
<h4 id="int-0x15"><a href="#int-0x15" class="headerlink" title="int 0x15"></a>int 0x15</h4><p>功能号ah=0x88，作用是获取系统所含扩展内存大小</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：ah = 0x88</span><br><span class="line">返回：ax = 从0x100000(1M)处开始的拓展内存大小(KB)。若出错则CF置位，ax = 出错码。</span><br></pre></td></tr></table></figure>
<h4 id="int-0x41"><a href="#int-0x41" class="headerlink" title="int 0x41"></a>int 0x41</h4><p>在PC机中BIOS设定的中断向量表中int 0x41的中断向量位置 (4 ∗ 0 x 41 = 0 x 0000 : 0 x 0104 4*0x41 = 0x0000:0x01044∗0x41=0x0000:0x0104)存放的并不是中断程序的地址,而是第一个硬盘的基本参数表。对于100%兼容的BIOS来说,这里存放着硬盘参数表阵列的首地址0xF000:0E401，第二个硬盘的基本参数表入口地址存于int 0x46中断向量位置处.每个硬盘参数表有16个字节大小.</p>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><h4 id="lds"><a href="#lds" class="headerlink" title="lds"></a>lds</h4><p>格式： LDS reg16，mem32</p>
<p>其意义是同时给一个段寄存器和一个16位通用寄存器同时赋值</p>
<p>举例：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>地址</th>
<th>100H</th>
<th>101H</th>
<th>102H</th>
<th>103H</th>
</tr>
</thead>
<tbody>
<tr>
<td>内容</td>
<td>00H</td>
<td>41H</td>
<td>02H</td>
<td>03H</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LDS AX,[100H]</span><br><span class="line">! 结果：AX=4100H  DS=0302H</span><br><span class="line">可以理解为</span><br><span class="line">mov AX,[100H]</span><br><span class="line">mov DS,[100H+2]</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/05/04/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-Linux-0-00-%E5%A4%9A%E4%BB%BB%E5%8A%A1%E5%88%87%E6%8D%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/04/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-Linux-0-00-%E5%A4%9A%E4%BB%BB%E5%8A%A1%E5%88%87%E6%8D%A2/" class="post-title-link" itemprop="url">调试分析 Linux 0.00 多任务切换</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-05-04 15:17:11 / Modified: 21:51:59" itemprop="dateCreated datePublished" datetime="2022-05-04T15:17:11+08:00">2022-05-04</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="调试分析-Linux-0-00-多任务切换"><a href="#调试分析-Linux-0-00-多任务切换" class="headerlink" title="调试分析 Linux 0.00 多任务切换"></a>调试分析 Linux 0.00 多任务切换</h1><h2 id="执行-153-行-iret-时栈的变化"><a href="#执行-153-行-iret-时栈的变化" class="headerlink" title="执行 153 行 iret 时栈的变化"></a>执行 153 行 iret 时栈的变化</h2><p>执行前栈的内容</p>
<p><img src="/2022/05/04/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-Linux-0-00-%E5%A4%9A%E4%BB%BB%E5%8A%A1%E5%88%87%E6%8D%A2/image-20220504154137710.png" alt="image-20220504154137710" style="zoom:50%;"></p>
<p>执行后栈的内容</p>
<p><img src="/2022/05/04/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-Linux-0-00-%E5%A4%9A%E4%BB%BB%E5%8A%A1%E5%88%87%E6%8D%A2/image-20220504154156025.png" alt="image-20220504154156025" style="zoom:50%;"></p>
<p>在执行前后进行了栈的切换，从任务0的内核栈切换到了任务的用户栈。</p>
<h2 id="模式切换"><a href="#模式切换" class="headerlink" title="模式切换"></a>模式切换</h2><p>当进入和退出 <code>system_interrupt</code> 时，都发生了模式切换，请总结模式切换时，特权级是如何改变的？栈切换吗？如何进行切换的？</p>
<p>在进入中断时，通过查询IDT表，获得索引，之后进行特权级检查，要求CPL&lt;=调用门DPL；RPL&lt;=调用门DPL。DPL&lt;=CPL。特权级检查通过，则特权级改变。栈也进行切换。处理器从当前任务的TSS段获得该中断使用的堆栈的段选择符与栈指针，然后把被中断的栈选择符与栈指针压入新栈。EFLAGES、CS、EIP的值也被压栈。</p>
<p>当退出时，使用iret指令。把保存的寄存器内容恢复到EFLAGES中，完成特权级复原，即切换为3。同时栈也切换回原来的栈。</p>
<h2 id="任务切换过程"><a href="#任务切换过程" class="headerlink" title="任务切换过程"></a>任务切换过程</h2><p>当时钟中断发生，进入到 <code>timer_interrupt</code> 程序，请详细记录从任务 <code>0</code> 切换到任务 <code>1</code> 的过程。</p>
<p><img src="/2022/05/04/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-Linux-0-00-%E5%A4%9A%E4%BB%BB%E5%8A%A1%E5%88%87%E6%8D%A2/image-20220504170543986.png" alt="image-20220504170543986" style="zoom: 33%;"></p>
<p>以本图为例分析。说明第一次切换时的状况，第一次切换，即时钟中断发生时，大概率会在227行，此时任务号为0，当跳入时钟中断后，从125行开始进行转换，首先将1写入寄存器eax，然后判断，因为此时任务号为0，所以不执行127行，执行128行，则将任务号改为1，然后在129行跳转到任务1的代码段。</p>
<p>任务0时的寄存器如下：</p>
<p><img src="/2022/05/04/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-Linux-0-00-%E5%A4%9A%E4%BB%BB%E5%8A%A1%E5%88%87%E6%8D%A2/W30F_428FK4HUQ8]K0{NQS.jpg" alt="img" style="zoom:50%;"></p>
<p>任务1时的寄存器如下：</p>
<p><img src="/2022/05/04/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-Linux-0-00-%E5%A4%9A%E4%BB%BB%E5%8A%A1%E5%88%87%E6%8D%A2/image-20220504205616009.png" alt="image-20220504205616009" style="zoom:50%;"></p>
<h2 id="任务切回过程"><a href="#任务切回过程" class="headerlink" title="任务切回过程"></a>任务切回过程</h2><p>又过了 <code>10ms</code> ，从任务1切换回到任务 <code>0</code> ，整个流程是怎样的？ <code>TSS</code> 是如何变化的？各个寄存器的值是如何变化的？</p>
<p><img src="/2022/05/04/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-Linux-0-00-%E5%A4%9A%E4%BB%BB%E5%8A%A1%E5%88%87%E6%8D%A2/image-20220504170543986.png" alt="image-20220504170543986" style="zoom:33%;"></p>
<p>如图，承接上题叙述，从代码段228执行，在232循环，大概率在循环时进行时间中断发生，在126行比较时，由于此时任务号为1，所以跳转到131行，将任务号设为0，在132行处，跳转到任务0，由于任务0执行到129行，所以从130执行，再跳转到133行，弹栈后通过iret返回，由于上次为在226行触发中断，所以回到226行。</p>
<p>寄存器变化如下：</p>
<p><img src="/2022/05/04/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-Linux-0-00-%E5%A4%9A%E4%BB%BB%E5%8A%A1%E5%88%87%E6%8D%A2/QQ图片20220504212642.png" alt="QQ图片20220504212642" style="zoom: 33%;"></p>
<p>变至</p>
<p><img src="/2022/05/04/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-Linux-0-00-%E5%A4%9A%E4%BB%BB%E5%8A%A1%E5%88%87%E6%8D%A2/(PWOBGOQ)2`%MSLMDHDOG4X.png" alt="img" style="zoom:33%;"></p>
<p>下图为任务0的TSS</p>
<p><img src="/2022/05/04/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-Linux-0-00-%E5%A4%9A%E4%BB%BB%E5%8A%A1%E5%88%87%E6%8D%A2/image-20220504214234727.png" alt="image-20220504214234727" style="zoom:33%;"></p>
<p>下图为任务1的TSS</p>
<p><img src="/2022/05/04/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-Linux-0-00-%E5%A4%9A%E4%BB%BB%E5%8A%A1%E5%88%87%E6%8D%A2/image-20220504214319515.png" alt="image-20220504214319515" style="zoom: 33%;"></p>
<h2 id="详细总结任务切换的过程"><a href="#详细总结任务切换的过程" class="headerlink" title="详细总结任务切换的过程"></a>详细总结任务切换的过程</h2><p><img src="/2022/05/04/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-Linux-0-00-%E5%A4%9A%E4%BB%BB%E5%8A%A1%E5%88%87%E6%8D%A2/image-20220504170543986.png" alt="image-20220504170543986" style="zoom:33%;"></p>
<p>还是对照这张图片，从头来讲。</p>
<p>第一次切换，即时钟中断发生时，大概率会在227行，此时任务号为0，当跳入时钟中断后，从125行开始进行转换，首先将1写入寄存器eax，然后判断，因为此时任务号为0，所以不执行127行，执行128行，则将任务号改为1，然后在129行跳转到任务1的代码段。</p>
<p>从代码段228执行，在232循环，大概率在循环时进行时间中断发生，在126行比较时，由于此时任务号为1，所以跳转到131行，将任务号设为0，在132行处，跳转到任务0，由于任务0执行到129行，所以从130执行，再跳转到133行，弹栈后通过iret返回，由于上次为在226行触发中断，所以回到226行。</p>
<p>然后大概率在此行，再次遇到时间中断，从125行开始进行转换，首先将1写入寄存器eax，然后判断，因为此时任务号为0，所以不执行127行，执行128行，则将任务号改为1，然后在129行跳转到任务1。由于任务1上次执行至</p>
<p>132行，所以从133行开始，到iret返回至232行。</p>
<p>又大概率在232行遇到时钟中断，执行到126行比较后跳转到131行，将任务号变为0，回到任务0的代码段。</p>
<p>至此为一个流程。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/26/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90Linux0-00%E5%BC%95%E5%AF%BC%E7%A8%8B%E5%BA%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/26/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90Linux0-00%E5%BC%95%E5%AF%BC%E7%A8%8B%E5%BA%8F/" class="post-title-link" itemprop="url">调试分析Linux0.00引导程序</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-04-26 15:34:03" itemprop="dateCreated datePublished" datetime="2022-04-26T15:34:03+08:00">2022-04-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-04-27 23:47:22" itemprop="dateModified" datetime="2022-04-27T23:47:22+08:00">2022-04-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="调试分析Linux0-00引导程序"><a href="#调试分析Linux0-00引导程序" class="headerlink" title="调试分析Linux0.00引导程序"></a>调试分析Linux0.00引导程序</h1><h2 id="简述head-s的工作原理"><a href="#简述head-s的工作原理" class="headerlink" title="简述head.s的工作原理"></a>简述head.s的工作原理</h2><p>​        主要包括初始设置与任务执行切换。</p>
<p>​        初始设置包括：</p>
<p>1.设置GDT表。</p>
<p>2.设置系统定时芯片。</p>
<p>3.设置IDT表。</p>
<p>4.切换到任务0。</p>
<p>任务执行切换则为：</p>
<p>​        head.s程序中把定时器芯片8253的通道0设置成每经过10ms就向中断控制芯片8259A发送一个时钟中断请求信号。PC机的ROM BIOS开机时已经在8259A把时钟中断请求信号设置成中断向量8，在中断8的处理过程中执行任务切换操作。任务切换的实现方法是查看current变量中当前运行任务号，若当前为0，就利用任务1的TSS选择符作为操作数执行远跳转指令，从而切换到任务1中执行，否则反之。</p>
<p>​        每个任务在执行时，会先把一个字符的ASCLL码放入寄存器AL中，然后调用系统中断调用int 0x80，而该系统调用处理过程则会调用一个简单的字符写屏子程序，把寄存器AL中的字符显示在屏幕上，同时把字符显示的屏幕下一个位置记录下来，作为下一次显示字符的屏幕位置。在显示过一个字符后，任务代码会使用循环语句延迟一段时间，然后跳转到任务代码开始出继续循环执行，从而不断显示。</p>
<h2 id="记录head-s的内存分布情况"><a href="#记录head-s的内存分布情况" class="headerlink" title="记录head.s的内存分布情况"></a>记录head.s的内存分布情况</h2><p>首先从GDT表看起，GDTR为0x998(3f)，则跳转到0x998去。寄存器SS的内容为0010。</p>
<p>由于第一项为空，则从第二项看，第二项为FF 07 00 00 00 9A C0 00。将其填写到段描述中，发现其S为1，TYPE为A，为代码段，G为1，段限长为0 07 FF ，基地址为0。则实际段长度为8MB。</p>
<p>第三项为FF 07 00 00 00 93 C0 00。将其填写到段描述中，发现其S为1，TYPE为3，为栈段，G为1，段限长为0 07 FF ，基地址为0，B/D为1。</p>
<p>第四项为02 00 00 80 0B 92 C0 00，将其填写到段描述符中，发现其S为1，TYPE为2，为数据段，G为1，段限长为0 00 02，基地址为0XB8000。则实际段长度为8KB。</p>
<p>第五、第六、七项S为0。</p>
<p>再查询任务0 LDT表</p>
<p>同理分析，则代码段与数据段基地址均为0，段限长为0x03ff，实际长度为4MB。</p>
<p>再查询任务1 LDT表</p>
<p>同理分析，则代码段与数据段基地址均为0，段限长为0x03ff，实际长度为4MB。</p>
<p>再运行到任务0处，此时SS寄存器为0x17，栈段基地址为0，段限长为0x03ff。</p>
<p>运行到任务1同理，此时SS寄存器为0x17，栈段基地址为0，段限长为0x03ff。</p>
<p>初始化的代码段起始地址为0，段长为8MB，则终止地址为0X800000。数据段起始地址为0XB8000，段长为8kb，终止地址为0XBA000。</p>
<p>任务0的代码段起始地址为0，段长为4MB，则终止地址为0X400000。数据段起始地址为0，段长为4MB，则终止地址为0X400000。</p>
<p>任务1的代码段起始地址为0，段长为4MB，则终止地址为0X400000。数据段起始地址为0，段长为4MB，则终止地址为0X400000。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>栈段编号</th>
<th>名称</th>
<th>起始地址</th>
<th>终止地址</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>init_stack</td>
<td>0x9d8</td>
<td>0xbd8</td>
</tr>
<tr>
<td>2</td>
<td>Km_stk0</td>
<td>0xc60</td>
<td>0xe60</td>
</tr>
<tr>
<td>3</td>
<td>Km_stk1</td>
<td>0xe00</td>
<td>0x10e0</td>
</tr>
<tr>
<td>4</td>
<td>User _stk1</td>
<td>0x1108</td>
<td>0x1308</td>
</tr>
</tbody>
</table>
</div>
<h2 id="简述head-s-57-62行"><a href="#简述head-s-57-62行" class="headerlink" title="简述head.s 57-62行"></a>简述head.s 57-62行</h2><p>将新调度任务（任务0）的上下文，加载进处理器中，并将从加载的EIP指向的指令出开始执行。具体操作为</p>
<p>57：将任务0当前局部空间数据段选择符入栈，</p>
<p>58：将堆栈指针入栈，</p>
<p>59：将标志寄存器值入栈，</p>
<p>60：将当前局部空间代码段选择符入栈，</p>
<p>61：将代码指针入栈，</p>
<p>62：通过执行中断返回指令，切换到特权级3的任务0执行。·    </p>
<h2 id="简述iret执行后，PC如何找到下一条指令。"><a href="#简述iret执行后，PC如何找到下一条指令。" class="headerlink" title="简述iret执行后，PC如何找到下一条指令。"></a>简述iret执行后，PC如何找到下一条指令。</h2><p><img src="/2022/04/26/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90Linux0-00%E5%BC%95%E5%AF%BC%E7%A8%8B%E5%BA%8F/image-20220427150129063.png" alt="image-20220427150129063"></p>
<p>在iret执行前，eip的值为000000ac,esp为00000bc4，cs的值为0008，栈顶的值为000010e0，然后执行iret。</p>
<p><img src="/2022/04/26/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90Linux0-00%E5%BC%95%E5%AF%BC%E7%A8%8B%E5%BA%8F/image-20220427150336651.png" alt="image-20220427150336651"></p>
<p>栈内五条内容均被弹出，其中000010e0被写入eip，同时0000000f被写入cs，则获得了下一条指令的地址。</p>
<h2 id="记录iret执行前后，栈的变化"><a href="#记录iret执行前后，栈的变化" class="headerlink" title="记录iret执行前后，栈的变化"></a>记录iret执行前后，栈的变化</h2><p>执行前</p>
<p><img src="/2022/04/26/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90Linux0-00%E5%BC%95%E5%AF%BC%E7%A8%8B%E5%BA%8F/image-20220427151617085.png" alt="image-20220427151617085"></p>
<p>执行后</p>
<p><img src="/2022/04/26/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90Linux0-00%E5%BC%95%E5%AF%BC%E7%A8%8B%E5%BA%8F/image-20220427151627637.png" alt="image-20220427151627637"></p>
<p>看上述两张图，图一为执行时，ss为0010，esp为00000bc4，当iret执行后，会弹出五条内容。分别为之前保存的寄存器eip的值，寄存器cs的值，标志寄存器eflags的值，寄存器esp的值，寄存器ss的值。</p>
<h2 id="系统调用int-0x80时，栈的变化情况"><a href="#系统调用int-0x80时，栈的变化情况" class="headerlink" title="系统调用int 0x80时，栈的变化情况"></a>系统调用int 0x80时，栈的变化情况</h2><p>调用int 0x80前，栈为task0或task1的用户栈</p>
<p><img src="/2022/04/26/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90Linux0-00%E5%BC%95%E5%AF%BC%E7%A8%8B%E5%BA%8F/image-20220427151837544.png" alt="image-20220427151837544"></p>
<p>调用int 0x80后，为此任务的系统栈。</p>
<p><img src="/2022/04/26/%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90Linux0-00%E5%BC%95%E5%AF%BC%E7%A8%8B%E5%BA%8F/image-20220427152127334.png" alt="image-20220427152127334"></p>
<p>由于执行前任务特权级为3，而执行后任务特权级为0，所以进行了栈切换。压入了中断前的ss、栈指针、标志寄存器、cs和下一条指令的eip。ss寄存器的值也发生了相应变化。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/23/%E7%A2%B3%E6%8E%92%E6%94%BE%E5%88%86%E6%9E%90%E6%A8%A1%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/23/%E7%A2%B3%E6%8E%92%E6%94%BE%E5%88%86%E6%9E%90%E6%A8%A1%E5%9E%8B/" class="post-title-link" itemprop="url">碳排放分析模型</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-04-23 11:27:17 / Modified: 17:07:28" itemprop="dateCreated datePublished" datetime="2022-04-23T11:27:17+08:00">2022-04-23</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>用两个模型来预测，再用三组数据比较分析。</p>
<p>同时为了避免大环境的干扰，应对未试点的省份也进行预测。同时证明模型的合理性。</p>
<h2 id="机制设计及实验研究"><a href="#机制设计及实验研究" class="headerlink" title="机制设计及实验研究"></a>机制设计及实验研究</h2><p>整体思路：</p>
<p>上海实施试点是2014年，所以我们采取14-19年作为政策采取后的数据，采用08-13作为政策采取前的数据。</p>
<p>通过08-13年的数据，采用合成控制法与..模型两种方式，预测分析政策未被实施的情况下上海地区的碳排放量，</p>
<p>模型中需要注意：</p>
<p>由于碳排放量所受的影响因素是多方面的，基于控制变量的原则，我们采用合成控制法预测上海地区的碳排放量时，所选择的其他地区应是未被试点的地区，同时我们假设，国家各地区整体的经济发展趋势大致拟合经济发展曲线，可消除一部分经济等其他因素对于实验数据的干扰。对于..模型，我们同样假设经济发展拟合经济发展曲线。通过这两种方式，我们可扩大我们所研究的试点政策对于碳排放量的影响。</p>
<p>为了验证我们预测模型的正确性，我们进行了稳健性检验，平行趋势检验，异质性分析。</p>
<p>稳健性检验：对于未试点的地区，同样用该模型进行预测，对预测数据与实际数据比较，发现拟合度较高，验证模型基本正确。</p>
<p>平行趋势检验：对于上海地区与选择的其他地区，在试点政策颁布前，有关碳排放政策大致相同。同时碳排放曲线大致相同。</p>
<p>异质性检验：</p>
<p>最后，对于模拟产生的两组数据，与实际数据，我们通过..分析法，对于三组数据进行分析，得出…</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/22/CMIS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/22/CMIS/" class="post-title-link" itemprop="url">CMIS</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-04-22 10:59:18" itemprop="dateCreated datePublished" datetime="2022-04-22T10:59:18+08:00">2022-04-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-04-25 20:41:47" itemprop="dateModified" datetime="2022-04-25T20:41:47+08:00">2022-04-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="教室管理信息系统"><a href="#教室管理信息系统" class="headerlink" title="教室管理信息系统"></a>教室管理信息系统</h1><p>在之前的基础上进行改进，优化了数据结构和存储设计，改进了索引结构，满足第四范式。</p>
<h2 id="数据库部分"><a href="#数据库部分" class="headerlink" title="数据库部分"></a>数据库部分</h2><h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">create database CMIS</span><br><span class="line">on primary</span><br><span class="line">(</span><br><span class="line">name=&#x27;f1&#x27;,</span><br><span class="line">filename=&#x27;F:\sqlserver\sqlwj\cmis\f1.mdf&#x27;,</span><br><span class="line">size=3mb,</span><br><span class="line">maxsize=unlimited,</span><br><span class="line">filegrowth=3%</span><br><span class="line">),</span><br><span class="line">(</span><br><span class="line">name=&#x27;f2&#x27;,																																																																																																					</span><br><span class="line">filename=&#x27;F:\sqlserver\sqlwj\cmis\f2.ndf&#x27;,</span><br><span class="line">size=10mb,</span><br><span class="line">maxsize=500mb,</span><br><span class="line">filegrowth=6mb</span><br><span class="line">)</span><br><span class="line">log on</span><br><span class="line">(</span><br><span class="line">name=&#x27;f3&#x27;,</span><br><span class="line">filename=&#x27;F:\sqlserver\sqlwj\cmis\f3.ldf&#x27;,</span><br><span class="line">size=1mb,</span><br><span class="line">maxsize=unlimited,</span><br><span class="line">filegrowth=2%</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>创建学生信息表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">create table 学生信息</span><br><span class="line">(</span><br><span class="line">学号 char(10) not null,</span><br><span class="line">姓名 varchar(15) not null,</span><br><span class="line">性别 varchar(5) not null,</span><br><span class="line">院系号 varchar(5) not null,</span><br><span class="line">密码 varchar(15) not null</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>创建教师信息表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">--创建教师信息表</span><br><span class="line">create table 教师信息</span><br><span class="line">(</span><br><span class="line">教师编号 char(10) not null,</span><br><span class="line">教师姓名 varchar(15) not null,</span><br><span class="line">性别 varchar(5) not null,</span><br><span class="line">院系号 varchar(5) not null,</span><br><span class="line">职称 varchar(15) not null,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>创建院系信息表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">--创建院系信息表</span><br><span class="line">create table 院系信息</span><br><span class="line">(</span><br><span class="line">院系号 varchar(5) not null,</span><br><span class="line">院系名称 varchar(15) not null</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>创建教室信息表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">--创建教室信息表</span><br><span class="line">create table 教室信息</span><br><span class="line">(</span><br><span class="line">教室编号 varchar(5) not null,</span><br><span class="line">教学楼编号 varchar(5) not null,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>创建教学楼信息表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">--创建教学楼信息表</span><br><span class="line">create table 教学楼信息</span><br><span class="line">(</span><br><span class="line">教学楼名称 varchar(10) not null,</span><br><span class="line">教学楼编号 varchar(5) not null</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>创建课程信息表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">--创建课程信息表</span><br><span class="line">create table 课程信息</span><br><span class="line">(</span><br><span class="line">课程名称 varchar(30) not null,</span><br><span class="line">课程编号 varchar(7) not null,</span><br><span class="line">教师编号 char(10) not null,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>创建教室使用信息表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">--创建教室使用信息表</span><br><span class="line">create table 教室使用信息</span><br><span class="line">(</span><br><span class="line">教室编号 varchar(5) not null,</span><br><span class="line">时间 varchar(10) not null,</span><br><span class="line">状态 varchar(10) not null,</span><br><span class="line">课程编号 varchar(7) not null </span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>创建课程时间表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">--创建课程时间表</span><br><span class="line">create table 课程时间</span><br><span class="line">(</span><br><span class="line">课程编号 varchar(7) not null,</span><br><span class="line">上课时间 varchar(10) not null,</span><br><span class="line">上课教室 varchar(5) not null</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="约束"><a href="#约束" class="headerlink" title="约束"></a>约束</h3><p>设置主键</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">--将教师信息表中教师编号设置为主键约束，身份证号设为唯一约束</span><br><span class="line">alter table 教师信息 </span><br><span class="line">add constraint PK_教师编号 primary key (教师编号)</span><br><span class="line">--将学生信息表中学号设置为主键约束，身份证号设为唯一约束</span><br><span class="line">alter table 学生信息 </span><br><span class="line">add constraint PK_学号 primary key (学号)</span><br><span class="line">--将教室信息中教室编号设置为主键</span><br><span class="line">alter table 教室信息</span><br><span class="line">add constraint PK_教室编号 primary key(教室编号)</span><br><span class="line">--将教学楼信息中教学楼编号设置为主键</span><br><span class="line">alter table 教学楼信息</span><br><span class="line">add constraint PK_教学楼编号 primary key(教学楼编号)</span><br><span class="line">--将院系信息中院系号号设置为主键</span><br><span class="line">alter table 院系信息</span><br><span class="line">add constraint PK_院系号 primary key(院系号)</span><br><span class="line">--将课程信息中课程编号设置为主键</span><br><span class="line">alter table 课程信息</span><br><span class="line">add constraint PK_课程编号 primary key(课程编号)</span><br></pre></td></tr></table></figure>
<p>设置外键约束</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">--将教师信息中的院系号与院系信息中的院系号添加外键</span><br><span class="line">alter table 教师信息</span><br><span class="line">add constraint FK_教师院系号 foreign key(院系号)references 院系信息(院系号)</span><br><span class="line"></span><br><span class="line">--将教学楼信息中的教学楼编号与教室信息中的教学楼编号添加外键</span><br><span class="line">alter table 教室信息</span><br><span class="line">add constraint FK_教学楼编号 foreign key(教学楼编号)references 教学楼信息(教学楼编号)</span><br><span class="line"></span><br><span class="line">--将学生信息中的院系号与院系信息中的院系号添加外键</span><br><span class="line">alter table 学生信息</span><br><span class="line">add constraint FK_学生院系号 foreign key(院系号)references 院系信息(院系号)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--将教室使用信息表中教室编号与教室信息表中的教室编号添加外键</span><br><span class="line">alter table 教室使用信息</span><br><span class="line">add constraint FK_教室编号教室使用信息 foreign key (教室编号)references 教室信息(教室编号)</span><br><span class="line"></span><br><span class="line">--将教室使用信息表中课程编号与课程信息表中的课程编号添加外键</span><br><span class="line">alter table 教室使用信息</span><br><span class="line">add constraint FK_课程编号教室使用信息 foreign key (课程编号)references 课程信息(课程编号)</span><br><span class="line"></span><br><span class="line">--对课程信息表中教师编号添加外键约束</span><br><span class="line">alter table 课程信息</span><br><span class="line">add constraint FK_教师编号课程信息 foreign key(教师编号)references 教师信息(教师编号)</span><br><span class="line"></span><br><span class="line">--对课程时间表中上课教室添加外键约束</span><br><span class="line">alter table 课程时间</span><br><span class="line">add constraint FK_上课教室课程时间 foreign key(上课教室)references 教室信息(教室编号)</span><br><span class="line"></span><br><span class="line">--对课程时间表中课程编号添加外键约束</span><br><span class="line">alter table 课程时间</span><br><span class="line">add constraint FK_课程编号课程时间 foreign key(课程编号)references 课程信息(课程编号)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>设置检查约束</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">--对教师信息中的性别添加约束</span><br><span class="line">　　alter table 教师信息</span><br><span class="line">　　add constraint CK_性别教师 check (性别=&#x27;男&#x27; or 性别=&#x27;女&#x27;)</span><br><span class="line"></span><br><span class="line">--对学生信息中的性别添加约束</span><br><span class="line">　　alter table 学生信息</span><br><span class="line">　　add constraint CK_性别学生 check (性别=&#x27;男&#x27; or 性别=&#x27;女&#x27;)</span><br><span class="line"></span><br><span class="line">--对教室使用信息的时间进行约束</span><br><span class="line">  alter table 教室使用信息</span><br><span class="line">  add constraint CK_时间 check (时间=&#x27;周一一二&#x27; or 时间=&#x27;周一三四&#x27; or 时间=&#x27;周一五六&#x27; or 时间=&#x27;周一七八&#x27; or </span><br><span class="line">  时间=&#x27;周二一二&#x27; or 时间=&#x27;周二三四&#x27; or 时间=&#x27;周二五六&#x27; or 时间=&#x27;周二七八&#x27; or </span><br><span class="line">  时间=&#x27;周三一二&#x27; or 时间=&#x27;周三三四&#x27; or 时间=&#x27;周三五六&#x27; or 时间=&#x27;周三七八&#x27; or </span><br><span class="line">  时间=&#x27;周四一二&#x27; or 时间=&#x27;周四三四&#x27; or 时间=&#x27;周四五六&#x27; or 时间=&#x27;周四七八&#x27; or </span><br><span class="line">  时间=&#x27;周五一二&#x27; or 时间=&#x27;周五三四&#x27; or 时间=&#x27;周五五六&#x27; or 时间=&#x27;周五七八&#x27; or </span><br><span class="line">  时间=&#x27;周六一二&#x27; or 时间=&#x27;周六三四&#x27; or 时间=&#x27;周六五六&#x27; or 时间=&#x27;周六七八&#x27; or </span><br><span class="line">  时间=&#x27;周日一二&#x27; or 时间=&#x27;周日三四&#x27; or 时间=&#x27;周日五六&#x27; or 时间=&#x27;周日七八&#x27; </span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">--对课程时间中上课时间约束</span><br><span class="line">alter table 课程时间</span><br><span class="line">  add constraint CK_课程时间 check (上课时间=&#x27;周一一二&#x27; or 上课时间=&#x27;周一三四&#x27; or 上课时间=&#x27;周一五六&#x27; or 上课时间=&#x27;周一七八&#x27; or </span><br><span class="line">  上课时间=&#x27;周二一二&#x27; or 上课时间=&#x27;周二三四&#x27; or 上课时间=&#x27;周二五六&#x27; or 上课时间=&#x27;周二七八&#x27; or </span><br><span class="line">  上课时间=&#x27;周三一二&#x27; or 上课时间=&#x27;周三三四&#x27; or 上课时间=&#x27;周三五六&#x27; or 上课时间=&#x27;周三七八&#x27; or </span><br><span class="line">  上课时间=&#x27;周四一二&#x27; or 上课时间=&#x27;周四三四&#x27; or 上课时间=&#x27;周四五六&#x27; or 上课时间=&#x27;周四七八&#x27; or </span><br><span class="line">  上课时间=&#x27;周五一二&#x27; or 上课时间=&#x27;周五三四&#x27; or 上课时间=&#x27;周五五六&#x27; or 上课时间=&#x27;周五七八&#x27; or </span><br><span class="line">  上课时间=&#x27;周六一二&#x27; or 上课时间=&#x27;周六三四&#x27; or 上课时间=&#x27;周六五六&#x27; or 上课时间=&#x27;周六七八&#x27; or </span><br><span class="line">  上课时间=&#x27;周日一二&#x27; or 上课时间=&#x27;周日三四&#x27; or 上课时间=&#x27;周日五六&#x27; or 上课时间=&#x27;周日七八&#x27; </span><br><span class="line">  )</span><br></pre></td></tr></table></figure>
<h3 id="插入信息"><a href="#插入信息" class="headerlink" title="插入信息"></a>插入信息</h3><p>插入教学楼基本信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">insert into 教学楼信息</span><br><span class="line">values(&#x27;正心&#x27;,&#x27;ZX&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教学楼信息</span><br><span class="line">values(&#x27;诚意&#x27;,&#x27;CY&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教学楼信息</span><br><span class="line">values(&#x27;格物&#x27;,&#x27;GW&#x27;)</span><br></pre></td></tr></table></figure>
<p>插入教室基本信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;ZX101&#x27;,&#x27;ZX&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;ZX102&#x27;,&#x27;ZX&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;ZX103&#x27;,&#x27;ZX&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;ZX104&#x27;,&#x27;ZX&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;ZX201&#x27;,&#x27;ZX&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;ZX202&#x27;,&#x27;ZX&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;ZX203&#x27;,&#x27;ZX&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;ZX204&#x27;,&#x27;ZX&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;ZX301&#x27;,&#x27;ZX&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;ZX302&#x27;,&#x27;ZX&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;ZX303&#x27;,&#x27;ZX&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;ZX304&#x27;,&#x27;ZX&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;ZX401&#x27;,&#x27;ZX&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;ZX402&#x27;,&#x27;ZX&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;ZX403&#x27;,&#x27;ZX&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;ZX404&#x27;,&#x27;ZX&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;ZX501&#x27;,&#x27;ZX&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;ZX502&#x27;,&#x27;ZX&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;ZX503&#x27;,&#x27;ZX&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;ZX504&#x27;,&#x27;ZX&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;ZX601&#x27;,&#x27;ZX&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;ZX602&#x27;,&#x27;ZX&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;ZX603&#x27;,&#x27;ZX&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;ZX604&#x27;,&#x27;ZX&#x27;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;CY101&#x27;,&#x27;CY&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;CY102&#x27;,&#x27;CY&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;CY103&#x27;,&#x27;CY&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;CY104&#x27;,&#x27;CY&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;CY201&#x27;,&#x27;CY&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;CY202&#x27;,&#x27;CY&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;CY203&#x27;,&#x27;CY&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;CY204&#x27;,&#x27;CY&#x27;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;GW101&#x27;,&#x27;GW&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;GW102&#x27;,&#x27;GW&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;GW103&#x27;,&#x27;GW&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;GW104&#x27;,&#x27;GW&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;GW201&#x27;,&#x27;GW&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;GW202&#x27;,&#x27;GW&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;GW203&#x27;,&#x27;GW&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教室信息</span><br><span class="line">values(&#x27;GW204&#x27;,&#x27;GW&#x27;)</span><br></pre></td></tr></table></figure>
<p>插入院系信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">insert into 院系信息</span><br><span class="line">values(&#x27;001&#x27;,&#x27;计算机&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 院系信息</span><br><span class="line">values(&#x27;002&#x27;,&#x27;航天&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 院系信息</span><br><span class="line">values(&#x27;003&#x27;,&#x27;机电工程&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 院系信息</span><br><span class="line">values(&#x27;004&#x27;,&#x27;材料科学&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 院系信息</span><br><span class="line">values(&#x27;005&#x27;,&#x27;数学&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 院系信息</span><br><span class="line">values(&#x27;006&#x27;,&#x27;经济与管理&#x27;)</span><br></pre></td></tr></table></figure>
<p>插入教师信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">insert into 教师信息</span><br><span class="line">values(&#x27;0000000001&#x27;,&#x27;姜老师&#x27;,&#x27;男&#x27;,&#x27;006&#x27;,&#x27;教授&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教师信息</span><br><span class="line">values(&#x27;0000000002&#x27;,&#x27;邹老师&#x27;,&#x27;男&#x27;,&#x27;001&#x27;,&#x27;教授&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教师信息</span><br><span class="line">values(&#x27;0000000003&#x27;,&#x27;陈老师&#x27;,&#x27;女&#x27;,&#x27;001&#x27;,&#x27;教授&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教师信息</span><br><span class="line">values(&#x27;0000000004&#x27;,&#x27;金老师&#x27;,&#x27;男&#x27;,&#x27;006&#x27;,&#x27;教授&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教师信息</span><br><span class="line">values(&#x27;0000000005&#x27;,&#x27;左老师&#x27;,&#x27;男&#x27;,&#x27;001&#x27;,&#x27;教授&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 教师信息</span><br><span class="line">values(&#x27;0000000006&#x27;,&#x27;刘老师&#x27;,&#x27;男&#x27;,&#x27;001&#x27;,&#x27;教授&#x27;)</span><br></pre></td></tr></table></figure>
<p>插入课程信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">insert into 课程信息</span><br><span class="line">values(&#x27;国际结算&#x27;,&#x27;EM32907&#x27;,&#x27;0000000001&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 课程信息</span><br><span class="line">values(&#x27;数据库系统&#x27;,&#x27;CS33503&#x27;,&#x27;0000000002&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 课程信息</span><br><span class="line">values(&#x27;编译系统&#x27;,&#x27;CS33502&#x27;,&#x27;0000000003&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 课程信息</span><br><span class="line">values(&#x27;国际企业管理&#x27;,&#x27;EM32408&#x27;,&#x27;0000000004&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 课程信息</span><br><span class="line">values(&#x27;模式识别与深度学习&#x27;,&#x27;CS33262&#x27;,&#x27;0000000005&#x27;)</span><br><span class="line"></span><br><span class="line">insert into 课程信息</span><br><span class="line">values(&#x27;操作系统设计与实现&#x27;,&#x27;CS32202&#x27;,&#x27;0000000006&#x27;)</span><br></pre></td></tr></table></figure>
<p>插入课程时间</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">insert into 教室使用信息</span><br><span class="line"> values(&#x27;ZX301&#x27;,&#x27;周一三四&#x27;,&#x27;有课&#x27;,&#x27;CS32202&#x27;)</span><br><span class="line"> insert into 教室使用信息</span><br><span class="line"> values(&#x27;ZX301&#x27;,&#x27;周三三四&#x27;,&#x27;有课&#x27;,&#x27;CS32202&#x27;)</span><br><span class="line">  insert into 课程时间</span><br><span class="line"> values(&#x27;CS32202&#x27;,&#x27;周一三四&#x27;,&#x27;ZX301&#x27;)</span><br><span class="line">  insert into 课程时间</span><br><span class="line"> values(&#x27;CS32202&#x27;,&#x27;周三三四&#x27;,&#x27;ZX301&#x27;)</span><br><span class="line"> </span><br><span class="line"> insert into 教室使用信息</span><br><span class="line"> values(&#x27;ZX201&#x27;,&#x27;周一七八&#x27;,&#x27;有课&#x27;,&#x27;CS33262&#x27;)</span><br><span class="line"> insert into 教室使用信息</span><br><span class="line"> values(&#x27;ZX201&#x27;,&#x27;周三五六&#x27;,&#x27;有课&#x27;,&#x27;CS33262&#x27;)</span><br><span class="line"> insert into 课程时间</span><br><span class="line"> values(&#x27;CS33262&#x27;,&#x27;周一七八&#x27;,&#x27;ZX201&#x27;)</span><br><span class="line">  insert into 课程时间</span><br><span class="line"> values(&#x27;CS33262&#x27;,&#x27;周三五六&#x27;,&#x27;ZX201&#x27;)</span><br><span class="line"> </span><br><span class="line"> insert into 教室使用信息</span><br><span class="line"> values(&#x27;ZX202&#x27;,&#x27;周二三四&#x27;,&#x27;有课&#x27;,&#x27;CS33502&#x27;)</span><br><span class="line"> insert into 教室使用信息</span><br><span class="line"> values(&#x27;ZX202&#x27;,&#x27;周四一二&#x27;,&#x27;有课&#x27;,&#x27;CS33502&#x27;)</span><br><span class="line"> insert into 课程时间</span><br><span class="line"> values(&#x27;CS33502&#x27;,&#x27;周二三四&#x27;,&#x27;ZX202&#x27;)</span><br><span class="line">  insert into 课程时间</span><br><span class="line"> values(&#x27;CS33502&#x27;,&#x27;周四一二&#x27;,&#x27;ZX202&#x27;)</span><br><span class="line"> </span><br><span class="line"> insert into 教室使用信息</span><br><span class="line"> values(&#x27;ZX102&#x27;,&#x27;周一五六&#x27;,&#x27;有课&#x27;,&#x27;CS33503&#x27;)</span><br><span class="line"> insert into 教室使用信息</span><br><span class="line"> values(&#x27;ZX102&#x27;,&#x27;周四五六&#x27;,&#x27;有课&#x27;,&#x27;CS33503&#x27;)</span><br><span class="line"> insert into 课程时间</span><br><span class="line"> values(&#x27;CS33503&#x27;,&#x27;周一五六&#x27;,&#x27;ZX102&#x27;)</span><br><span class="line">  insert into 课程时间</span><br><span class="line"> values(&#x27;CS33503&#x27;,&#x27;周四五六&#x27;,&#x27;ZX102&#x27;)</span><br><span class="line"> </span><br><span class="line"> insert into 教室使用信息</span><br><span class="line"> values(&#x27;ZX402&#x27;,&#x27;周五一二&#x27;,&#x27;有课&#x27;,&#x27;EM32408&#x27;)</span><br><span class="line"> insert into 教室使用信息</span><br><span class="line"> values(&#x27;ZX402&#x27;,&#x27;周五三四&#x27;,&#x27;有课&#x27;,&#x27;EM32408&#x27;)</span><br><span class="line"> insert into 课程时间</span><br><span class="line"> values(&#x27;EM32408&#x27;,&#x27;周五一二&#x27;,&#x27;ZX402&#x27;)</span><br><span class="line">  insert into 课程时间</span><br><span class="line"> values(&#x27;EM32408&#x27;,&#x27;周五三四&#x27;,&#x27;ZX402&#x27;)</span><br><span class="line"> </span><br><span class="line"> insert into 教室使用信息</span><br><span class="line"> values(&#x27;ZX601&#x27;,&#x27;周四三四&#x27;,&#x27;有课&#x27;,&#x27;EM32907&#x27;)</span><br><span class="line"></span><br><span class="line"> insert into 课程时间</span><br><span class="line"> values(&#x27;EM32907&#x27;,&#x27;周四三四&#x27;,&#x27;ZX601&#x27;)</span><br></pre></td></tr></table></figure>
<h3 id="编写存储"><a href="#编写存储" class="headerlink" title="编写存储"></a>编写存储</h3><p>插入课程信息存储</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">create procedure information_entry</span><br><span class="line"> @coursename varchar(15),--输入参数，课程名称</span><br><span class="line"> @coursenumber varchar(7),--输入参数，课程编号</span><br><span class="line"> @coursetime varchar(10),--输入参数，课程时间</span><br><span class="line"> @teachername varchar(15),--输入参数，教师名称</span><br><span class="line"> @teachernumber char(10),--输入参数，教师编号</span><br><span class="line"> @buildingnumber varchar(5),--输入参数，教学楼编号</span><br><span class="line"> @roomnumber varchar(5)--输入参数教室编号</span><br><span class="line">AS</span><br><span class="line"> insert into 课程信息</span><br><span class="line"> values(@coursename,@coursenumber,@teachernumber)</span><br><span class="line"> insert into 课程时间</span><br><span class="line"> values(@coursenumber,@coursetime,@roomnumber)</span><br><span class="line"> insert into 教室使用信息</span><br><span class="line"> values(@roomnumber,@coursetime,&#x27;有课&#x27;,@coursenumber)</span><br><span class="line">go</span><br></pre></td></tr></table></figure>
<p>查询指定教室使用情况</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">create procedure classroom_query</span><br><span class="line"> @room varchar(5),</span><br><span class="line"> @time varchar(10),</span><br><span class="line"> @state varchar(10)=&#x27;空闲&#x27; output</span><br><span class="line"> AS</span><br><span class="line"></span><br><span class="line"> select @state=状态</span><br><span class="line"> from 教室使用信息</span><br><span class="line"> where 教室编号=@room and 时间=@time</span><br><span class="line"> if @state IS NULL</span><br><span class="line">   set  @state=&#x27;空闲&#x27;</span><br><span class="line">   else if @state=&#x27;有课&#x27;</span><br><span class="line">   begin</span><br><span class="line">    select @state=课程编号</span><br><span class="line"> from 教室使用信息</span><br><span class="line"> where 教室编号=@room and 时间=@time</span><br><span class="line"></span><br><span class="line">   end</span><br><span class="line"> go</span><br></pre></td></tr></table></figure>
<p>少一个查询指定课程</p>
<p>借用存储</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">declare @state varchar(10)</span><br><span class="line">go</span><br><span class="line">create procedure borrow</span><br><span class="line"> @building varchar(5),</span><br><span class="line"> @room varchar(5),</span><br><span class="line"> @time varchar(10),</span><br><span class="line"> @reason varchar(10),</span><br><span class="line"> @state varchar(10) output</span><br><span class="line">AS</span><br><span class="line">declare @state1 varchar(10)</span><br><span class="line"> select @state1=状态</span><br><span class="line"> from 教室使用信息</span><br><span class="line"> where 教室编号=@room and 时间=@time</span><br><span class="line"> if @state1 IS NULL</span><br><span class="line"> begin</span><br><span class="line">   set  @state1=&#x27;空闲&#x27;</span><br><span class="line">   </span><br><span class="line">   print &#x27;此时教室空闲，可以借用&#x27;</span><br><span class="line">   insert into 教室使用信息</span><br><span class="line">   values(@room,@time,@reason,&#x27;其他&#x27;)</span><br><span class="line">  end</span><br><span class="line">else</span><br><span class="line">  print &#x27;此教室被占用，正在&#x27;+@state1</span><br><span class="line">  set @state=@state1</span><br><span class="line">  print @state</span><br><span class="line">  go</span><br></pre></td></tr></table></figure>
<p>一个例子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select *from 教室使用信息</span><br><span class="line">declare @state varchar(10)</span><br><span class="line">exec borrow &#x27;001&#x27;,&#x27;1102&#x27;,&#x27;周一三四&#x27;,&#x27;其他&#x27;,@state output</span><br><span class="line">print @state</span><br></pre></td></tr></table></figure>
<p>判断密码是否正确</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">create procedure password_query</span><br><span class="line"> @user char(10),</span><br><span class="line"> @password varchar(15),</span><br><span class="line"> @state varchar(10)=&#x27;false&#x27; output</span><br><span class="line">AS</span><br><span class="line">declare @password1 varchar(15)</span><br><span class="line"> select @password1=密码  from 学生信息</span><br><span class="line"> where 学号=@user</span><br><span class="line"> if @password1 IS NOT NULL and @password1=@password</span><br><span class="line"> set @state=&#x27;true&#x27;</span><br><span class="line"> else</span><br><span class="line"> set @state=&#x27;false&#x27;</span><br><span class="line">go</span><br></pre></td></tr></table></figure>
<p>删除课程</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create procedure delete_course</span><br><span class="line"> @number varchar(7)</span><br><span class="line"> AS</span><br><span class="line">delete from 课程信息 where 课程编号=@number</span><br><span class="line">delete from 教室使用信息 where 课程编号=@number</span><br><span class="line">delete from 课程时间 where 课程编号=@number</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>删除教师</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">create procedure delete_teacher</span><br><span class="line"> @number char(10)</span><br><span class="line"> AS</span><br><span class="line"> delete from 课程时间 where 课程编号 in(</span><br><span class="line">select 课程编号 from 课程信息 where 教师编号=@number)</span><br><span class="line">delete from 教室使用信息 where 课程编号 in(</span><br><span class="line">select 课程编号 from 课程信息 where 教师编号=@number)</span><br><span class="line">delete from 课程信息 where 教师编号=@number</span><br><span class="line">delete from 教师信息 where 教师编号=@number</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>创建存储往学生信息插入大量数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">--创建循环插入10000条记录的存储过程</span><br><span class="line">CREATE  PROCEDURE CREATE_student </span><br><span class="line">AS</span><br><span class="line">declare @cnt INT=0;</span><br><span class="line">while @cnt&lt;10000</span><br><span class="line">begin</span><br><span class="line">declare @name varchar(15)</span><br><span class="line">set @name=(SELECT   LEFT(LOWER(NEWID()),8))</span><br><span class="line">declare @password varchar(15)</span><br><span class="line">set @password=(SELECT   LEFT(LOWER(NEWID()),9))</span><br><span class="line">declare @sex INT</span><br><span class="line">set @sex=(SELECT 1 + RAND() * 2)</span><br><span class="line">declare @sno char(10)</span><br><span class="line">set @sno=replace(str(@cnt,10),&#x27; &#x27;,&#x27;0&#x27;)</span><br><span class="line">declare @y INT</span><br><span class="line">set @y=(SELECT 1 + RAND() * 6)</span><br><span class="line">    INSERT INTO 学生信息</span><br><span class="line">    VALUES</span><br><span class="line">    (</span><br><span class="line">     @sno,</span><br><span class="line">    @name</span><br><span class="line">    ,CASE @sex  --随机选取3个枚举值</span><br><span class="line">          when 1 then &#x27;男&#x27;</span><br><span class="line">          when 2 then &#x27;女&#x27;                  </span><br><span class="line">     END</span><br><span class="line">	 ,CASE @y  --随机选取6个枚举值</span><br><span class="line">          when 1 then &#x27;001&#x27;</span><br><span class="line">          when 2 then &#x27;002&#x27; </span><br><span class="line">		  when 3 then &#x27;003&#x27;</span><br><span class="line">          when 4 then &#x27;004&#x27;</span><br><span class="line">		  when 5 then &#x27;005&#x27;</span><br><span class="line">          when 6 then &#x27;006&#x27;</span><br><span class="line">     END</span><br><span class="line">	  ,@password</span><br><span class="line">	  </span><br><span class="line">   </span><br><span class="line">    );</span><br><span class="line">	set @cnt=@cnt+1;</span><br><span class="line">end;</span><br></pre></td></tr></table></figure>
<h3 id="创建视图"><a href="#创建视图" class="headerlink" title="创建视图"></a>创建视图</h3><p>创建视图，查询计算机学院邹老师所有课程名称</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">--创建视图，查询计算机学院邹老师所有课程名称</span><br><span class="line">go</span><br><span class="line">create VIEW view_邹</span><br><span class="line">as </span><br><span class="line">select 课程名称 </span><br><span class="line">from 课程信息</span><br><span class="line">where 教师编号=&#x27;0000000002&#x27;</span><br><span class="line">go</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/19/DBMS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/19/DBMS/" class="post-title-link" itemprop="url">DBMS</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-04-19 15:19:14" itemprop="dateCreated datePublished" datetime="2022-04-19T15:19:14+08:00">2022-04-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-05-18 00:56:44" itemprop="dateModified" datetime="2022-05-18T00:56:44+08:00">2022-05-18</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="DBMS"><a href="#DBMS" class="headerlink" title="DBMS"></a>DBMS</h1><h2 id="一-绪论"><a href="#一-绪论" class="headerlink" title="一.绪论"></a>一.绪论</h2><h3 id="基于文件系统的数据管理方法"><a href="#基于文件系统的数据管理方法" class="headerlink" title="基于文件系统的数据管理方法"></a>基于文件系统的数据管理方法</h3><p><strong>特点</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">数据存储于文件中</span><br><span class="line">数据由应用程序经过文件系统进行管理</span><br></pre></td></tr></table></figure>
<p><strong>缺点</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">每当文件格式发生变化，就要修改应用程序</span><br><span class="line">文件中存在冗余数据</span><br><span class="line">文件修改可能造成数据不一致</span><br><span class="line">文件修改可能破坏数据正确性</span><br><span class="line">没有索引，只能扫描文件，数据访问效率低</span><br><span class="line">只能对整个文件进行访问控制，数据安全性差</span><br><span class="line">没有并发控制，多个应用程序同时读写文件可能产生冲突</span><br></pre></td></tr></table></figure>
<h3 id="基于数据库管理系统的数据管理方法"><a href="#基于数据库管理系统的数据管理方法" class="headerlink" title="基于数据库管理系统的数据管理方法"></a>基于数据库管理系统的数据管理方法</h3><p>特点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">数据存储在数据库中</span><br><span class="line">数据由应用程序经过数据库管理系统进行管理</span><br></pre></td></tr></table></figure>
<h3 id="基于二者的对比"><a href="#基于二者的对比" class="headerlink" title="基于二者的对比"></a>基于二者的对比</h3><p>（1）FS:每当文件格式发生变化，就要修改应用程序</p>
<p>​          DBMS：只要数据模式不发生重大变化，应用程序基本无需修改</p>
<p>（2）FS:文件中存在冗余数</p>
<p>​          DBMS：冗余数据较少</p>
<p>（3）FS:文件修改可能造成数据不一致</p>
<p>​          DBMS：在数据库规范情况下基本不会造成</p>
<p>（4）FS:文件修改可能会破坏数据正确性</p>
<p>​          DBMS：会对数据更新进行完整行进检查</p>
<p>（5）FS:没有索引，访问效率低</p>
<p>​          DBMS：提供索引</p>
<p>（6）FS:只能对整个文件进行访问控制，数据安全性差</p>
<p>​          DBMS：可规定用户对于数据库哪一部分进行操作</p>
<p>（7）FS:文4没有并发控制</p>
<p>​          DBMS：提供并发控制机制</p>
<h3 id="数据库功能"><a href="#数据库功能" class="headerlink" title="数据库功能"></a>数据库功能</h3><p><img src="/2022/04/19/DBMS/image-20220419155148171.png" alt="image-20220419155148171"></p>
<h3 id="数据库系统"><a href="#数据库系统" class="headerlink" title="数据库系统"></a>数据库系统</h3><p>由数据库、数据库管理系统、应用程序和数据库用户在一起构成的系统。</p>
<h3 id="数据库的三层模式结构"><a href="#数据库的三层模式结构" class="headerlink" title="数据库的三层模式结构"></a>数据库的三层模式结构</h3><p>数据库模式通常分三个层次定义，从低到高分别是:</p>
<p>内模式/存储模式</p>
<p>概念模式</p>
<p>外模式/视图</p>
<h4 id="内模式-存储模式"><a href="#内模式-存储模式" class="headerlink" title="内模式/存储模式"></a>内模式/存储模式</h4><p>描述数据库的物理存储结构和存取方式</p>
<p>数据库只有一个内模式</p>
<p>定义内模式时通常使用物理数据模型提供的概念</p>
<p><img src="/2022/04/19/DBMS/image-20220419161358869.png" alt="image-20220419161358869"></p>
<h4 id="概念模式"><a href="#概念模式" class="headerlink" title="概念模式"></a>概念模式</h4><p>为全体数据库用户描述整个数据库的结构和约束</p>
<p>数据库只有一个概念模式</p>
<p>定义概念模式时使用实现数据模型提供的概念</p>
<p><img src="/2022/04/19/DBMS/image-20220419161406993.png" alt="image-20220419161406993"></p>
<h4 id="外模式-视图"><a href="#外模式-视图" class="headerlink" title="外模式/视图"></a>外模式/视图</h4><p>从不同类别用户的视角描述数据库结构</p>
<p>可以有多个外模式</p>
<p>定义外模式时也可以使用实现数据模型提供的概念</p>
<h4 id="模式映射"><a href="#模式映射" class="headerlink" title="模式映射"></a>模式映射</h4><p>在三层模式结构中，不同层次模式之间的映射用于完成应用程序与数据库之间的数据转换和请求转换。</p>
<p><img src="/2022/04/19/DBMS/image-20220419161701579.png" alt="image-20220419161701579"></p>
<p><strong>分类</strong></p>
<p>外模式-概念模式映射</p>
<p>概念模式-内模式映射</p>
<h4 id="数据独立性"><a href="#数据独立性" class="headerlink" title="数据独立性"></a>数据独立性</h4><p>逻辑数据独立性</p>
<p>物理数据独立性</p>
<p><img src="/2022/04/19/DBMS/image-20220419161856014.png" alt="image-20220419161856014"></p>
<h3 id="数据库语言分类"><a href="#数据库语言分类" class="headerlink" title="数据库语言分类"></a>数据库语言分类</h3><p>数据定义语言</p>
<p>数据操作语言</p>
<h3 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h3><p>由数据库上的一系列操作完成的复杂任务，这些操作要么全执行，要么全不执行</p>
<p><strong>性质</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">原子性</span><br><span class="line">一致性</span><br><span class="line">隔离性</span><br><span class="line">持久性</span><br></pre></td></tr></table></figure>
<h3 id="并发控制"><a href="#并发控制" class="headerlink" title="并发控制"></a>并发控制</h3><p>为了充分利用，允许多个事务并发执行。</p>
<p>多个事务并发可能会破坏数据一致性。</p>
<h2 id="二-关系数据库"><a href="#二-关系数据库" class="headerlink" title="二.关系数据库"></a>二.关系数据库</h2><h3 id="关系数据模型"><a href="#关系数据模型" class="headerlink" title="关系数据模型"></a>关系数据模型</h3><p>三要素：关系数据结构、关系操作、关系完整性约束。</p>
<h4 id="关系数据结构"><a href="#关系数据结构" class="headerlink" title="关系数据结构"></a>关系数据结构</h4><p>关系中属性的个数即为关系的<strong>度</strong>。</p>
<p>只有符合客观实际的关系才是正确的关系。</p>
<p><strong>键</strong>：关系的某些属性集合具有区分不同元组的作用。</p>
<p><strong>超键</strong>：可以唯一标识每个元组的属性。</p>
<p><strong>候选键</strong>：任意真子集都不是超键的超键。即极小的超键。</p>
<p><strong>主键</strong>：每个关系都有至少一个候选键，人为指定其中一个作为主键。</p>
<p><strong>外键</strong>：设F为关系R的属性子集。若F与关系S的主键K相对，则称F为R的外键。</p>
<h4 id="关系操作"><a href="#关系操作" class="headerlink" title="关系操作"></a>关系操作</h4><p>查询语言的类型：关系代数、关系演算、结构化查询语言SQL。</p>
<h4 id="关系完整性约束"><a href="#关系完整性约束" class="headerlink" title="关系完整性约束"></a>关系完整性约束</h4><p>完整性约束的类型：实体完整性、参照完整性、用户定义完整性。</p>
<p>实体完整性约束规则</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">主键值唯一且非空。</span><br></pre></td></tr></table></figure>
<p>参照完整性约束</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">对于外键的约束，外键值为空或不为空则必须在S存在。</span><br></pre></td></tr></table></figure>
<p>用户定义完整性约束</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">根据需求定义。</span><br></pre></td></tr></table></figure>
<h3 id="关系代数"><a href="#关系代数" class="headerlink" title="关系代数"></a>关系代数</h3><p><img src="/2022/04/19/DBMS/image-20220429102419874.png" alt="image-20220429102419874" style="zoom:50%;"></p>
<h4 id="选择操作"><a href="#选择操作" class="headerlink" title="选择操作"></a>选择操作</h4><p><img src="/2022/04/19/DBMS/image-20220429102724224.png" alt="image-20220429102724224" style="zoom:50%;"></p>
<h4 id="投影操作"><a href="#投影操作" class="headerlink" title="投影操作"></a>投影操作</h4><p><img src="/2022/04/19/DBMS/image-20220429102802024.png" alt="image-20220429102802024" style="zoom:50%;"></p>
<h4 id="并操作"><a href="#并操作" class="headerlink" title="并操作"></a>并操作</h4><p><img src="/2022/04/19/DBMS/image-20220429102936467.png" alt="image-20220429102936467" style="zoom:50%;"></p>
<h4 id="差操作"><a href="#差操作" class="headerlink" title="差操作"></a>差操作</h4><p><img src="/2022/04/19/DBMS/image-20220429103101865.png" alt="image-20220429103101865" style="zoom:50%;"></p>
<h4 id="笛卡尔积操作"><a href="#笛卡尔积操作" class="headerlink" title="笛卡尔积操作"></a>笛卡尔积操作</h4><p><img src="/2022/04/19/DBMS/image-20220429103204733.png" alt="image-20220429103204733"></p>
<p>笛卡尔积作用仅仅是将R和S无条件连接起来。</p>
<h4 id="重命名操作"><a href="#重命名操作" class="headerlink" title="重命名操作"></a>重命名操作</h4><p><img src="/2022/04/19/DBMS/image-20220429103735239.png" alt="image-20220429103735239" style="zoom:50%;"></p>
<h4 id="派生关系代数操作"><a href="#派生关系代数操作" class="headerlink" title="派生关系代数操作"></a>派生关系代数操作</h4><p><img src="/2022/04/19/DBMS/image-20220429103929302.png" alt="image-20220429103929302" style="zoom:50%;"></p>
<h4 id="交操作"><a href="#交操作" class="headerlink" title="交操作"></a>交操作</h4><p><img src="/2022/04/19/DBMS/image-20220429103955343.png" alt="image-20220429103955343" style="zoom: 50%;"></p>
<h4 id="theta-连接"><a href="#theta-连接" class="headerlink" title="$\theta$连接"></a>$\theta$连接</h4><p><img src="/2022/04/19/DBMS/image-20220429104206279.png" alt="image-20220429104206279" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220429104313090.png" alt="image-20220429104313090" style="zoom:50%;"></p>
<p><strong>等值连接</strong>：连接条件仅涉及相等比较的连接称作等值连接。</p>
<h4 id="自然连接"><a href="#自然连接" class="headerlink" title="自然连接"></a>自然连接</h4><p><img src="/2022/04/19/DBMS/image-20220429104433735.png" alt="image-20220429104433735" style="zoom:50%;"></p>
<p>自然连接与$\theta$连接的区别</p>
<div class="table-container">
<table>
<thead>
<tr>
<th></th>
<th>自然连接</th>
<th>$\theta$连接</th>
</tr>
</thead>
<tbody>
<tr>
<td>连接条件</td>
<td>隐含给出</td>
<td>明确给出</td>
</tr>
<tr>
<td>结果属性</td>
<td>去掉重复的同名属性</td>
<td>保留重名的同名属性</td>
</tr>
</tbody>
</table>
</div>
<h4 id="左外连接"><a href="#左外连接" class="headerlink" title="左外连接"></a>左外连接</h4><p><img src="/2022/04/19/DBMS/image-20220429152859130.png" alt="image-20220429152859130" style="zoom:50%;"></p>
<h4 id="右外连接"><a href="#右外连接" class="headerlink" title="右外连接"></a>右外连接</h4><p><img src="/2022/04/19/DBMS/image-20220429152930580.png" alt="image-20220429152930580" style="zoom:50%;"></p>
<h4 id="全外连接"><a href="#全外连接" class="headerlink" title="全外连接"></a>全外连接</h4><p><img src="/2022/04/19/DBMS/image-20220429153001556.png" alt="image-20220429153001556" style="zoom:50%;"></p>
<h4 id="除"><a href="#除" class="headerlink" title="除"></a>除</h4><p><img src="/2022/04/19/DBMS/image-20220429153136222.png" alt="image-20220429153136222" style="zoom:50%;"></p>
<h4 id="扩展关系代数操作"><a href="#扩展关系代数操作" class="headerlink" title="扩展关系代数操作"></a>扩展关系代数操作</h4><p><img src="/2022/04/19/DBMS/image-20220429153530381.png" alt="image-20220429153530381" style="zoom:50%;"></p>
<h4 id="分组操作"><a href="#分组操作" class="headerlink" title="分组操作"></a>分组操作</h4><p><img src="/2022/04/19/DBMS/image-20220429153851312.png" alt="image-20220429153851312" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220429154021150.png" alt="image-20220429154021150" style="zoom:50%;"></p>
<p>eg：<img src="/2022/04/19/DBMS/image-20220429154350259.png" alt="image-20220429154350259" style="zoom:50%;"></p>
<h4 id="赋值操作"><a href="#赋值操作" class="headerlink" title="赋值操作"></a>赋值操作</h4><p><img src="/2022/04/19/DBMS/image-20220429154424910.png" alt="image-20220429154424910" style="zoom:50%;"></p>
<h3 id="关系演算"><a href="#关系演算" class="headerlink" title="关系演算"></a>关系演算</h3><p><img src="/2022/04/19/DBMS/image-20220429154749803.png" alt="image-20220429154749803" style="zoom:50%;"></p>
<p>eg：<img src="/2022/04/19/DBMS/image-20220429154903454.png" alt="image-20220429154903454" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220429155326624.png" alt="image-20220429155326624" style="zoom:50%;"></p>
<p>eg：<img src="/2022/04/19/DBMS/image-20220429155635735.png" alt="image-20220429155635735" style="zoom:50%;"></p>
<h2 id="三、结构化查询语言"><a href="#三、结构化查询语言" class="headerlink" title="三、结构化查询语言"></a>三、结构化查询语言</h2><h3 id="SQL数据定义"><a href="#SQL数据定义" class="headerlink" title="SQL数据定义"></a>SQL数据定义</h3><p><strong>声明用户定义完整性约束</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">规定属性值非空</span><br><span class="line">规定属性值不重复</span><br><span class="line">定义属性缺省值</span><br><span class="line">规定属性值必须满足表达式给出的条件</span><br></pre></td></tr></table></figure>
<p><strong>定义视图</strong></p>
<p>从用户视角所看到的数据</p>
<h3 id="数据更新"><a href="#数据更新" class="headerlink" title="数据更新"></a>数据更新</h3><p>修改：update 关系名 set </p>
<p><strong>数据完整性检查</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">目的：数据修改可能导致数据库违反完整性约束，需要对数据完整性进行检查</span><br><span class="line">功能：实体完整性检查</span><br><span class="line">参照完整性检查</span><br><span class="line">用户定义完整性检查</span><br></pre></td></tr></table></figure>
<h3 id="数据查询"><a href="#数据查询" class="headerlink" title="数据查询"></a>数据查询</h3><p>选择查询条件</p>
<p><img src="/2022/04/19/DBMS/image-20220430151413245.png" alt="image-20220430151413245" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220430151423792.png" alt="image-20220430151423792" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220430151432387.png" alt="image-20220430151432387" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220430151614464.png" alt="image-20220430151614464" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220430152007869.png" alt="image-20220430152007869" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220430152148390.png" alt="image-20220430152148390" style="zoom:50%;"></p>
<p><strong>注意</strong>：空值判断，应用 is null,不可以用 =或者！=</p>
<p>集合操作</p>
<p><img src="/2022/04/19/DBMS/image-20220430152507160.png" alt="image-20220430152507160" style="zoom:50%;"></p>
<p>查询结果排序</p>
<p><img src="/2022/04/19/DBMS/image-20220430152758643.png" alt="image-20220430152758643" style="zoom:50%;"></p>
<p>限制查询结果数量</p>
<p><img src="/2022/04/19/DBMS/image-20220430153226417.png" alt="image-20220430153226417" style="zoom:50%;"></p>
<p>聚集查询</p>
<p><img src="/2022/04/19/DBMS/image-20220430153259151.png" alt="image-20220430153259151" style="zoom:50%;"></p>
<p><strong>注</strong>：聚集函数不能出现在where子句中</p>
<p>分组查询</p>
<p><img src="/2022/04/19/DBMS/image-20220430154427314.png" alt="image-20220430154427314" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220430154532489.png" alt="image-20220430154532489" style="zoom:50%;"></p>
<p><strong>注意事项</strong></p>
<p><img src="/2022/04/19/DBMS/image-20220430154629326.png" alt="image-20220430154629326" style="zoom:50%;"></p>
<h4 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h4><p>内连接</p>
<p><img src="/2022/04/19/DBMS/image-20220430154937567.png" alt="image-20220430154937567" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220430155011604.png" alt="image-20220430155011604" style="zoom:50%;"></p>
<p>自然连接</p>
<p><img src="/2022/04/19/DBMS/image-20220430155059752.png" alt="image-20220430155059752" style="zoom:50%;"></p>
<p>自连接</p>
<p><img src="/2022/04/19/DBMS/image-20220430155231450.png" alt="image-20220430155231450" style="zoom:50%;"></p>
<p>外连接</p>
<p><img src="/2022/04/19/DBMS/image-20220430155522668.png" alt="image-20220430155522668" style="zoom:50%;"></p>
<h4 id="嵌套查询"><a href="#嵌套查询" class="headerlink" title="嵌套查询"></a>嵌套查询</h4><p><img src="/2022/04/19/DBMS/image-20220430155907373.png" alt="image-20220430155907373" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220430162018068.png" alt="image-20220430162018068" style="zoom:50%;"></p>
<p>使用exists关键字进行查询的时候，首先，我们先查询的不是子查询的内容，而是查我们的主查询的表，然后，根据表的每一条记录，依次去判断where后面的条件是否成立。</p>
<p>in在查询的时候，首先查询子查询的表，然后将内表和外表做一个笛卡尔积，然后按照条件进行筛选。所以相对内表比较小的时候，in的速度较快。</p>
<p>嵌套查询的写法</p>
<p><img src="/2022/04/19/DBMS/image-20220430162413322.png" alt="image-20220430162413322" style="zoom:50%;"></p>
<p>派生</p>
<p><img src="/2022/04/19/DBMS/image-20220430162522047.png" alt="image-20220430162522047" style="zoom:50%;"></p>
<h2 id="四、概念数据库设计"><a href="#四、概念数据库设计" class="headerlink" title="四、概念数据库设计"></a>四、概念数据库设计</h2><h3 id="数据库设计的过程"><a href="#数据库设计的过程" class="headerlink" title="数据库设计的过程"></a>数据库设计的过程</h3><p><img src="/2022/04/19/DBMS/image-20220503171629777.png" alt="image-20220503171629777" style="zoom:50%;"></p>
<h3 id="实体-联系模型"><a href="#实体-联系模型" class="headerlink" title="实体-联系模型"></a>实体-联系模型</h3><p><strong>实体-联系模型</strong>：简称ER模型，用于将现实世界抽象为实体及实体间的联系。</p>
<p>ER模型概念：</p>
<p><img src="/2022/04/19/DBMS/image-20220503194731246.png" alt="image-20220503194731246" style="zoom:50%;"></p>
<h4 id="与实体相关的概念"><a href="#与实体相关的概念" class="headerlink" title="与实体相关的概念"></a>与实体相关的概念</h4><p><strong>实体</strong>：数据库中表示的现实世界中的具体对象或事物。</p>
<p><strong>属性</strong>：用于刻画实体的特性。</p>
<p><strong>属性的类型</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">简单属性</span><br><span class="line">复合属性</span><br><span class="line">多值属性</span><br><span class="line">派生属性</span><br></pre></td></tr></table></figure>
<p><img src="/2022/04/19/DBMS/image-20220503195624675.png" alt="image-20220503195624675"></p>
<h5 id="实体型的ER图表示"><a href="#实体型的ER图表示" class="headerlink" title="实体型的ER图表示"></a>实体型的ER图表示</h5><p><img src="/2022/04/19/DBMS/image-20220503200250388.png" alt="image-20220503200250388" style="zoom:50%;"></p>
<p><strong>弱实体型</strong>：没有键属性的实体型。</p>
<p><strong>标识实体型、属主实体型</strong>：由于弱实体型没有键属性，需要依赖于其他实体型进行区分。</p>
<p><strong>标识联系型</strong>：弱实体型与其标识实体型通过标识联系型关联。</p>
<p><strong>部分键</strong>：用于区分和同一标识实体相关联的弱实体的属性集合。</p>
<p><img src="/2022/04/19/DBMS/image-20220503201117189.png" alt="image-20220503201117189" style="zoom:50%;"></p>
<h4 id="与联系相关的概念"><a href="#与联系相关的概念" class="headerlink" title="与联系相关的概念"></a>与联系相关的概念</h4><p><strong>联系</strong>：一个联系表示多个实体之间有意义的关联关系。</p>
<p><strong>联系型</strong>：同一类联系共同具有的类型。</p>
<p><strong>联系型的度</strong>：参与到一个联系型中的实体型的个数。</p>
<p><strong>联系集</strong>：数据库中当前存储的联系型的实例的集合。</p>
<p><img src="/2022/04/19/DBMS/image-20220503202245562.png" alt="image-20220503202245562" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220503202303200.png" alt="image-20220503202303200" style="zoom:50%;"></p>
<h5 id="联系型的约束"><a href="#联系型的约束" class="headerlink" title="联系型的约束"></a>联系型的约束</h5><p><img src="/2022/04/19/DBMS/image-20220503202559606.png" alt="image-20220503202559606" style="zoom:50%;"></p>
<p><strong>存在依赖约束/参与度约束</strong>：刻画实体型参与到联系型中的最小基数。</p>
<h5 id="联系型的属性"><a href="#联系型的属性" class="headerlink" title="联系型的属性"></a>联系型的属性</h5><p><img src="/2022/04/19/DBMS/image-20220503204803972.png" alt="image-20220503204803972" style="zoom:50%;"></p>
<p>多元联系：3个以上实体参与的联系</p>
<h3 id="增强ER模型"><a href="#增强ER模型" class="headerlink" title="增强ER模型"></a>增强ER模型</h3><p><img src="/2022/04/19/DBMS/image-20220503205006243.png" alt="image-20220503205006243" style="zoom:50%;"></p>
<h5 id="子类-超类"><a href="#子类-超类" class="headerlink" title="子类/超类"></a>子类/超类</h5><p><img src="/2022/04/19/DBMS/image-20220503205634485.png" alt="image-20220503205634485" style="zoom:50%;"></p>
<p><strong>不相交子类</strong>：若超类的每个实体属于最多一个子类，则子类是不相交的。</p>
<p><strong>重叠子类</strong>：若超类的每个实体可以属于多个子类，则子类是重叠的。</p>
<p><strong>全部特化</strong>：超类的每个实体必须属于至少一个子类。</p>
<p><strong>部分特化</strong>；超类的某些实体可以不属于任何子类。</p>
<h2 id="五、逻辑数据库设计"><a href="#五、逻辑数据库设计" class="headerlink" title="五、逻辑数据库设计"></a>五、逻辑数据库设计</h2><h3 id="ER模型转换为关系数据库模式"><a href="#ER模型转换为关系数据库模式" class="headerlink" title="ER模型转换为关系数据库模式"></a>ER模型转换为关系数据库模式</h3><p><strong>实体型的转换</strong></p>
<p><img src="/2022/04/19/DBMS/image-20220503211916414.png" alt="image-20220503211916414" style="zoom:50%;"></p>
<p><strong>复合属性的转换</strong></p>
<p><img src="/2022/04/19/DBMS/image-20220503211959174.png" alt="image-20220503211959174" style="zoom:50%;"></p>
<p><strong>多值属性的转换</strong></p>
<p><img src="/2022/04/19/DBMS/image-20220503212559635.png" alt="image-20220503212559635" style="zoom:50%;"></p>
<p><strong>弱实体型的转换</strong></p>
<p><img src="/2022/04/19/DBMS/image-20220503213011437.png" alt="image-20220503213011437" style="zoom:50%;"></p>
<p><strong>M:N二元联系型的转换</strong></p>
<p><img src="/2022/04/19/DBMS/image-20220503213209789.png" alt="image-20220503213209789" style="zoom:50%;"></p>
<p><strong>N:1二元联系型的转换</strong></p>
<p><img src="/2022/04/19/DBMS/image-20220505150449415.png" alt="image-20220505150449415" style="zoom:50%;"></p>
<p><strong>1:1二元联系型的转换</strong></p>
<p>与N:1相同</p>
<p><strong>二元自联系型的转换</strong></p>
<p><img src="/2022/04/19/DBMS/image-20220505150832315.png" alt="image-20220505150832315" style="zoom: 50%;"></p>
<p><strong>标识联系型的转换</strong></p>
<p><img src="/2022/04/19/DBMS/image-20220505151309647.png" alt="image-20220505151309647" style="zoom:50%;"></p>
<p><strong>设计不合理的关系可能产生的异常问题</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">数据更新问题</span><br><span class="line">数据冗余问题</span><br></pre></td></tr></table></figure>
<p><strong>知识要点图</strong></p>
<p><img src="/2022/04/19/DBMS/image-20220505152648076.png" alt="image-20220505152648076" style="zoom:50%;"></p>
<h3 id="函数依赖"><a href="#函数依赖" class="headerlink" title="函数依赖"></a>函数依赖</h3><p>定义</p>
<p><img src="/2022/04/19/DBMS/image-20220505153034089.png" alt="image-20220505153034089" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220505153146687.png" alt="image-20220505153146687" style="zoom:50%;"></p>
<p>类型</p>
<p><img src="/2022/04/19/DBMS/image-20220505153456821.png" alt="image-20220505153456821" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220505154107287.png" alt="image-20220505154107287" style="zoom:50%;"></p>
<h4 id="函数依赖的公理系统"><a href="#函数依赖的公理系统" class="headerlink" title="函数依赖的公理系统"></a>函数依赖的公理系统</h4><p><strong>逻辑蕴含</strong></p>
<p><img src="/2022/04/19/DBMS/image-20220505154619657.png" alt="image-20220505154619657" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220505154814471.png" alt="image-20220505154814471" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220505155016364.png" alt="image-20220505155016364" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220505155029011.png" alt="image-20220505155029011" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220505155051886.png" alt="image-20220505155051886" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220505155443317.png" alt="image-20220505155443317" style="zoom:50%;"></p>
<h4 id="等价函数依赖集"><a href="#等价函数依赖集" class="headerlink" title="等价函数依赖集"></a>等价函数依赖集</h4><p><strong>相关概念</strong></p>
<p><img src="/2022/04/19/DBMS/image-20220505161038489.png" alt="image-20220505161038489" style="zoom:50%;"></p>
<p><strong>最小覆盖</strong></p>
<p><img src="/2022/04/19/DBMS/image-20220505161611936.png" alt="image-20220505161611936" style="zoom:50%;"></p>
<h3 id="关系模式的范式"><a href="#关系模式的范式" class="headerlink" title="关系模式的范式"></a>关系模式的范式</h3><h4 id="第一范式"><a href="#第一范式" class="headerlink" title="第一范式"></a>第一范式</h4><p>若关系模式R的每个属性都是不可分的，则称R为第一范式关系模式。</p>
<p>存在问题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">数据插入异常</span><br><span class="line">数据删除异常</span><br><span class="line">数据修改繁琐</span><br><span class="line">数据冗余</span><br></pre></td></tr></table></figure>
<p>原因</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">非主属性部分函数依赖于候选键</span><br></pre></td></tr></table></figure>
<h4 id="第二范式"><a href="#第二范式" class="headerlink" title="第二范式"></a>第二范式</h4><p><img src="/2022/04/19/DBMS/image-20220505162809352.png" alt="image-20220505162809352" style="zoom:50%;"></p>
<p>存在问题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">数据插入异常</span><br><span class="line">数据删除异常</span><br><span class="line">数据修改繁琐</span><br><span class="line">数据冗余</span><br></pre></td></tr></table></figure>
<p>原因</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">非主属性传递函数依赖于候选键</span><br></pre></td></tr></table></figure>
<h4 id="第三范式"><a href="#第三范式" class="headerlink" title="第三范式"></a>第三范式</h4><p><img src="/2022/04/19/DBMS/image-20220505163512256.png" alt="image-20220505163512256" style="zoom:50%;"></p>
<p>存在问题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">数据插入异常</span><br><span class="line">数据删除异常</span><br><span class="line">数据修改繁琐</span><br><span class="line">数据冗余</span><br></pre></td></tr></table></figure>
<p>原因</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">主属性部分依赖于候选键</span><br></pre></td></tr></table></figure>
<h4 id="BCNF"><a href="#BCNF" class="headerlink" title="BCNF"></a>BCNF</h4><p><img src="/2022/04/19/DBMS/image-20220505164427068.png" alt="image-20220505164427068" style="zoom:50%;"></p>
<p>消除主属性间的传递依赖。</p>
<h3 id="关系模式分解"><a href="#关系模式分解" class="headerlink" title="关系模式分解"></a>关系模式分解</h3><p><img src="/2022/04/19/DBMS/image-20220505221923466.png" alt="image-20220505221923466" style="zoom:50%;"></p>
<p>分解准则1：无损连接性</p>
<p><img src="/2022/04/19/DBMS/image-20220505223653143.png" alt="image-20220505223653143" style="zoom:50%;"></p>
<p>分解准则2：函数依赖保持性</p>
<p><img src="/2022/04/19/DBMS/image-20220505224121199.png" alt="image-20220505224121199" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220505224450639.png" alt="image-20220505224450639" style="zoom:50%;"></p>
<p>无损连接性判定</p>
<p><img src="/2022/04/19/DBMS/image-20220505224650480.png" alt="image-20220505224650480" style="zoom:50%;"></p>
<p>函数依赖保持性判定</p>
<p><img src="/2022/04/19/DBMS/image-20220505225103477.png" alt="image-20220505225103477" style="zoom:50%;"></p>
<h4 id="关系模式分解方法"><a href="#关系模式分解方法" class="headerlink" title="关系模式分解方法"></a>关系模式分解方法</h4><p><img src="/2022/04/19/DBMS/image-20220505225520028.png" alt="image-20220505225520028" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220505225621412.png" alt="image-20220505225621412" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220505230144599.png" alt="image-20220505230144599" style="zoom:50%;"></p>
<h2 id="六、物理数据库设计"><a href="#六、物理数据库设计" class="headerlink" title="六、物理数据库设计"></a>六、物理数据库设计</h2><h3 id="物理数据库设计概述"><a href="#物理数据库设计概述" class="headerlink" title="物理数据库设计概述"></a>物理数据库设计概述</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在逻辑数据库设计的基础上，为数据库中的关系选择合适的存储结构和存取方法，并进行数据库调优，使数据库上的事务能够高效执行。</span><br></pre></td></tr></table></figure>
<p><img src="/2022/04/19/DBMS/image-20220517092422735.png" alt="image-20220517092422735" style="zoom: 50%;"></p>
<h3 id="工作负载分析"><a href="#工作负载分析" class="headerlink" title="工作负载分析"></a>工作负载分析</h3><p><strong>工作负载</strong>是一组混合在一起的查询和更新。</p>
<p><strong>选择度</strong>：满足条件的结果元组在全部候选元组中所占的比例。</p>
<h3 id="索引设计"><a href="#索引设计" class="headerlink" title="索引设计"></a>索引设计</h3><p><strong>索引设计的基本过程</strong></p>
<p><img src="/2022/04/19/DBMS/image-20220517093148475.png" alt="image-20220517093148475" style="zoom: 50%;"></p>
<h4 id="索引设计的准则"><a href="#索引设计的准则" class="headerlink" title="索引设计的准则"></a><strong>索引设计的准则</strong></h4><p>1.是否建索引</p>
<p><img src="/2022/04/19/DBMS/image-20220517093239212.png" alt="image-20220517093239212" style="zoom: 50%;"></p>
<p>2.索引键的确定</p>
<p><img src="/2022/04/19/DBMS/image-20220517093413507.png" alt="image-20220517093413507" style="zoom:50%;"></p>
<p>3.复合索引的设计</p>
<p><img src="/2022/04/19/DBMS/image-20220517093654977.png" alt="image-20220517093654977" style="zoom:50%;"></p>
<p><strong>B+树支持的查询</strong></p>
<p>全值匹配：和所有索引属性进行匹配</p>
<p>匹配最左前缀：和前面几个索引属性进行匹配</p>
<p>匹配属性前缀：只匹配前缀属性的前缀部分</p>
<p>范围匹配：在给定范围内对前缀进行匹配</p>
<p>精确匹配某一属性并范围匹配另一属性</p>
<p>B+树还支持索引属性排序</p>
<p><strong>B+树的限制</strong></p>
<p>必须从B+树的最左属性开始匹配</p>
<p>条件中不能包含表达式</p>
<p>不能跳过B+树的属性</p>
<p>如果索引中有关某个属性的范围查询，则其右边所有属性都无法使用索引查找</p>
<p><strong>覆盖索引</strong></p>
<p>如果一个索引包含一个查询需要用到的所有属性，则称该索引为覆盖索引</p>
<p><img src="/2022/04/19/DBMS/image-20220517094732264.png" alt="image-20220517094732264" style="zoom:50%;"></p>
<p><strong>单个复合索引 vs 多个单属性索引</strong></p>
<p>方案一：建立一个符合索引</p>
<p>方案二：建立多个单属性索引</p>
<p>多个单属性索引的缺点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">没有在单个复合索引上做查询效率高</span><br><span class="line">索引合并涉及排序，要消耗大量计算和存储资源</span><br><span class="line">在查询优化时，索引合并的代价并不被计入，被低估了查询代价</span><br></pre></td></tr></table></figure>
<p>4.是否使用聚簇索引</p>
<p><img src="/2022/04/19/DBMS/image-20220517105950271.png" alt="image-20220517105950271" style="zoom:50%;"></p>
<ul>
<li>聚簇索引：将<a target="_blank" rel="noopener" href="https://cloud.tencent.com/product/cdcs?from=10680">数据存储</a>与索引放到了一块，找到索引也就找到了数据</li>
<li>非聚簇索引：将数据存储于索引分开结构，索引结构的叶子节点指向了数据的对应行，myisam通过key_buffer把索引先缓存到内存中，当需要访问数据时（通过索引访问数据），在内存中直接搜索索引，然后通过索引找到磁盘相应数据，这也就是为什么索引不在key buffer命中时，速度慢的原因</li>
</ul>
<p>不同存取路径区别</p>
<p><img src="/2022/04/19/DBMS/image-20220517110305889.png" alt="image-20220517110305889" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517110324506.png" alt="image-20220517110324506" style="zoom:50%;"></p>
<p>5.用哈希表还是B+树</p>
<p><img src="/2022/04/19/DBMS/image-20220517110351806.png" alt="image-20220517110351806" style="zoom:50%;"></p>
<p>哈希表的限制</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">不支持部分索引属性匹配</span><br><span class="line">只支持等值比较查询，不支持范围查询</span><br><span class="line">无法用于排序</span><br><span class="line">存在冲突</span><br></pre></td></tr></table></figure>
<p>6.权衡索引代价维护</p>
<p><img src="/2022/04/19/DBMS/image-20220517110455031.png" alt="image-20220517110455031"></p>
<p>7.不唯准则</p>
<p><img src="/2022/04/19/DBMS/image-20220517110521088.png" alt="image-20220517110521088"></p>
<h4 id="索引调优"><a href="#索引调优" class="headerlink" title="索引调优"></a>索引调优</h4><p>MYSQL索引设计技巧1：前缀索引</p>
<p><img src="/2022/04/19/DBMS/image-20220517110623727.png" alt="image-20220517110623727" style="zoom:50%;"></p>
<p>索引选择性：<img src="/2022/04/19/DBMS/image-20220517110657824.png" alt="image-20220517110657824" style="zoom:50%;"></p>
<p>MYSQL索引设计技巧2：聚簇索引</p>
<p><img src="/2022/04/19/DBMS/image-20220517110758667.png" alt="image-20220517110758667" style="zoom:50%;"></p>
<p>MYSQL索引设计技巧3：伪哈希索引</p>
<p><img src="/2022/04/19/DBMS/image-20220517110906396.png" alt="image-20220517110906396" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517110921919.png" alt="image-20220517110921919" style="zoom:50%;"></p>
<h3 id="内模式设计"><a href="#内模式设计" class="headerlink" title="内模式设计"></a>内模式设计</h3><p>关系是否采用聚簇索引？</p>
<p>若使用聚簇索引，应按哪些属性聚簇索引？</p>
<p>同聚簇索引设计准则。</p>
<h3 id="查询改写"><a href="#查询改写" class="headerlink" title="查询改写"></a>查询改写</h3><p>恒真/假的选择条件</p>
<p>含表达式的选择条件</p>
<p><img src="/2022/04/19/DBMS/image-20220517111330363.png" alt="image-20220517111330363" style="zoom:50%;"></p>
<p>无用的去重操作</p>
<p>无用的分组操作：分组操作昂贵</p>
<p>无用的投影操作</p>
<p>无用的连接操作</p>
<p>临时关系：占用额外存储空间，且其上没有索引</p>
<p>嵌套查询；查询器优化嵌套查询能力弱</p>
<p>类型转换</p>
<h3 id="概念模式调优"><a href="#概念模式调优" class="headerlink" title="概念模式调优"></a>概念模式调优</h3><p><img src="/2022/04/19/DBMS/image-20220517111617834.png" alt="image-20220517111617834" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517111626325.png" alt="image-20220517111626325" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517111717761.png" alt="image-20220517111717761" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517111725636.png" alt="image-20220517111725636" style="zoom:50%;"></p>
<p>数据类型选择</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.尽量使用可以正确存储的最小数据类型</span><br><span class="line">2.选择简单的数据类型</span><br><span class="line">3.最好将属性声明为not null</span><br></pre></td></tr></table></figure>
<p>标识符的选择</p>
<p><img src="/2022/04/19/DBMS/image-20220517111924723.png" alt="image-20220517111924723" style="zoom:50%;"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">整型：最好的选择，占用空间少，速度快</span><br><span class="line">ENUM和SET：糟糕的选择，比较时转换为字符串，速度慢，MYSQL内部用整型来存储这两个类型的值，占用空间少</span><br><span class="line">字符串型：糟糕的选择，空间大，速度慢</span><br></pre></td></tr></table></figure>
<h2 id="存储管理"><a href="#存储管理" class="headerlink" title="存储管理"></a>存储管理</h2><p>按CPU访问存储介质的方式，可将存储器分为三类。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">主存储器</span><br><span class="line">二级存储器</span><br><span class="line">三级存储器</span><br></pre></td></tr></table></figure>
<p>主存</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">包括：寄存器、高速缓存、内存</span><br><span class="line">主存特点：按字节寻址、可使用load/store指令直接访问</span><br></pre></td></tr></table></figure>
<p>二级存储器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">包括：磁盘/机械硬盘、闪存/固态硬盘</span><br><span class="line">特点：按块寻址、联机使用 CPU无法直接访问，需用read、write将数据先复制到主存</span><br></pre></td></tr></table></figure>
<p>三级存储器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">包括：磁带、光盘、网络存储</span><br><span class="line">脱机使用、按块存储、需先将数据复制到二级存储</span><br></pre></td></tr></table></figure>
<p>存储层次间的数据传输</p>
<p><img src="/2022/04/19/DBMS/image-20220517140913250.png" alt="image-20220517140913250" style="zoom: 50%;"></p>
<p><strong>数据局部性</strong>：同一单元的数据经常被同时访问到</p>
<p>虚拟内存不是存储层级中的一层。</p>
<p>按存储介质的易失性/持久性，可分为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">易失性存储器：计算机重启后，易失性存储器的数据会丢失</span><br><span class="line">菲易失性存储器</span><br></pre></td></tr></table></figure>
<p><img src="/2022/04/19/DBMS/image-20220517141520177.png" alt="image-20220517141520177" style="zoom:50%;"></p>
<p>持久性内存又称<strong>非易失性内存</strong>：按字节寻址、非易失</p>
<p>磁盘</p>
<p><img src="/2022/04/19/DBMS/image-20220517150119891.png" alt="image-20220517150119891" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517150149305.png" alt="image-20220517150149305" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517150221095.png" alt="image-20220517150221095" style="zoom:50%;"></p>
<h3 id="数据库的文件存储"><a href="#数据库的文件存储" class="headerlink" title="数据库的文件存储"></a>数据库的文件存储</h3><p>将一个数据库存储为一个或多个文件；每个文件包含多个页。</p>
<p>数据库文件的页可以存储元组、元数据、索引、日志记录等。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">大多数DBMS在一个页中只存储一种类型对象。</span><br></pre></td></tr></table></figure>
<p>每个页拥有唯一编号，称作页号。</p>
<p>DBMS的存储管理器负责管理数据库文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">记录页中元组的读/写</span><br><span class="line">记录页中的空闲空间</span><br></pre></td></tr></table></figure>
<p>文件存储的分类</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">面向行的存储</span><br><span class="line">面向列的存储</span><br></pre></td></tr></table></figure>
<h4 id="各种表示"><a href="#各种表示" class="headerlink" title="各种表示"></a>各种表示</h4><p>数<img src="/2022/04/19/DBMS/image-20220517150756822.png" alt="image-20220517150756822" style="zoom:50%;"></p>
<p>字符串<img src="/2022/04/19/DBMS/image-20220517150806178.png" alt="image-20220517150806178" style="zoom:50%;"></p>
<p>元组<img src="/2022/04/19/DBMS/image-20220517150906343.png" alt="image-20220517150906343" style="zoom:50%;"></p>
<p>元组头<img src="/2022/04/19/DBMS/image-20220517150929367.png" alt="image-20220517150929367" style="zoom:50%;"></p>
<p>元组数据<img src="/2022/04/19/DBMS/image-20220517150952603.png" alt="image-20220517150952603" style="zoom:50%;"></p>
<p>变长元组的布局<img src="/2022/04/19/DBMS/image-20220517151016064.png" alt="image-20220517151016064" style="zoom:50%;"></p>
<p>页布局<img src="/2022/04/19/DBMS/image-20220517151037574.png" alt="image-20220517151037574" style="zoom:50%;"></p>
<p>页头<img src="/2022/04/19/DBMS/image-20220517151052727.png" alt="image-20220517151052727" style="zoom:50%;"></p>
<p>页数据<img src="/2022/04/19/DBMS/image-20220517151136047.png" alt="image-20220517151136047" style="zoom:50%;"></p>
<p><strong>面向元组的组织方法</strong></p>
<p>分槽页是最常见的面向元组的数据组织方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">槽数据</span><br><span class="line">元组序列</span><br></pre></td></tr></table></figure>
<p><img src="/2022/04/19/DBMS/image-20220517151256195.png" alt="image-20220517151256195" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517151329418.png" alt="image-20220517151329418" style="zoom:50%;"></p>
<p>槽的元数据存储在页头中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">槽的数量：用于确定下一个空闲槽的编号</span><br><span class="line">最后一个槽的起始位置的偏移量：用于确定新元组的插入位置</span><br></pre></td></tr></table></figure>
<p><strong>记录号</strong></p>
<p><img src="/2022/04/19/DBMS/image-20220517151514495.png" alt="image-20220517151514495" style="zoom:50%;"></p>
<p><strong>溢出页</strong><img src="/2022/04/19/DBMS/image-20220517151912914.png" alt="image-20220517151912914" style="zoom:50%;"></p>
<p>页碎片化</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">随着元组删除或版本过期，其中会产生碎片：浪费磁盘空间、增加磁盘I/O</span><br></pre></td></tr></table></figure>
<p>日志结构页布局</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">文件中只存储数据更新操作的日志记录，而不存储元组</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">新的日志记录只能写到文件末尾</span><br><span class="line">插入操作的日志记录包含整个插入的元组</span><br><span class="line">删除操作的日志记录包含被删除的元组的主键</span><br><span class="line">修改操作的日志记录包含被修改的元组的主键，被修改的属性及修改后的属性值</span><br></pre></td></tr></table></figure>
<p>读元组<img src="/2022/04/19/DBMS/image-20220517153113658.png" alt="image-20220517153113658" style="zoom:50%;"></p>
<p>日志记录索引<img src="/2022/04/19/DBMS/image-20220517153153633.png" alt="image-20220517153153633" style="zoom:50%;"></p>
<p>日志记录合并<img src="/2022/04/19/DBMS/image-20220517153318250.png" alt="image-20220517153318250" style="zoom:50%;"></p>
<h4 id="文件组织"><a href="#文件组织" class="headerlink" title="文件组织"></a>文件组织</h4><p>法一：堆文件组织</p>
<p>法二：顺序/有序文件组织</p>
<p>法三：哈希文件组织</p>
<p><strong>堆文件组织</strong></p>
<p><img src="/2022/04/19/DBMS/image-20220517154020888.png" alt="image-20220517154020888" style="zoom:50%;"></p>
<p><strong>基于链表的页组织方式</strong></p>
<p><img src="/2022/04/19/DBMS/image-20220517154058030.png" alt="image-20220517154058030" style="zoom:50%;"></p>
<p><strong>基于页目录的堆文件页组织方式</strong></p>
<p><img src="/2022/04/19/DBMS/image-20220517154149229.png" alt="image-20220517154149229" style="zoom:50%;"></p>
<p><strong>顺序/有序文件组织</strong></p>
<p><img src="/2022/04/19/DBMS/image-20220517155245093.png" alt="image-20220517155245093" style="zoom:50%;"></p>
<p><strong>哈希文件组织</strong></p>
<p><img src="/2022/04/19/DBMS/image-20220517155305809.png" alt="image-20220517155305809" style="zoom:50%;"></p>
<h3 id="缓冲区管理"><a href="#缓冲区管理" class="headerlink" title="缓冲区管理"></a>缓冲区管理</h3><p><img src="/2022/04/19/DBMS/image-20220517155330366.png" alt="image-20220517155330366" style="zoom:50%;"></p>
<p>缓冲池的页称作页框</p>
<p>页表<img src="/2022/04/19/DBMS/image-20220517155451024.png" alt="image-20220517155451024" style="zoom:50%;"></p>
<p>DBMS用两个变量记录缓冲池中每个页框的状态</p>
<p><img src="/2022/04/19/DBMS/image-20220517155552825.png" alt="image-20220517155552825" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517155602529.png" alt="image-20220517155602529" style="zoom:50%;"></p>
<p>缓冲区功能</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">请求页；修改页；释放页</span><br></pre></td></tr></table></figure>
<p><strong>请求页</strong></p>
<p>1.<img src="/2022/04/19/DBMS/image-20220517155820278.png" alt="image-20220517155820278" style="zoom:50%;"></p>
<p>2.<img src="/2022/04/19/DBMS/image-20220517155834306.png" alt="image-20220517155834306" style="zoom:50%;"></p>
<p>3.<img src="/2022/04/19/DBMS/image-20220517155852966.png" alt="image-20220517155852966" style="zoom:50%;"></p>
<p>实际在情况3下，DBMS会终止提出该请求的事务，为了避免资源浪费</p>
<p><strong>页替换策略</strong></p>
<p><img src="/2022/04/19/DBMS/image-20220517160334148.png" alt="image-20220517160334148" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517160404076.png" alt="image-20220517160404076" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517160413288.png" alt="image-20220517160413288" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517160425855.png" alt="image-20220517160425855" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517160437840.png" alt="image-20220517160437840" style="zoom:50%;"></p>
<p>缓冲池与虚拟内存的相同点</p>
<p><img src="/2022/04/19/DBMS/image-20220517160507768.png" alt="image-20220517160507768" style="zoom:50%;"></p>
<p>缓冲池与虚拟内存的不同点</p>
<p>1.<img src="/2022/04/19/DBMS/image-20220517160644326.png" alt="image-20220517160644326" style="zoom:50%;"></p>
<p>2.<img src="/2022/04/19/DBMS/image-20220517160704040.png" alt="image-20220517160704040" style="zoom:50%;"></p>
<p><strong>面向行的存储</strong><img src="/2022/04/19/DBMS/image-20220517160738464.png" alt="image-20220517160738464" style="zoom:50%;"></p>
<p><strong>面向列的存储</strong><img src="/2022/04/19/DBMS/image-20220517160804399.png" alt="image-20220517160804399" style="zoom:50%;"></p>
<p>缺点：面向列的存储适合于联机分析处理，不适合于联机事务处理。元组重构代价高，元组删除和修改代价高；解压代价</p>
<h2 id="索引结构"><a href="#索引结构" class="headerlink" title="索引结构"></a>索引结构</h2><h3 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h3><p>有序索引：通过按索引键有序排列索引项来实现索引</p>
<p>哈希索引：通过按索引键哈希值分桶来实现索引</p>
<p>有序索引<img src="/2022/04/19/DBMS/image-20220517164143525.png" alt="image-20220517164143525" style="zoom:50%;"></p>
<p>哈希索引<img src="/2022/04/19/DBMS/image-20220517164528124.png" alt="image-20220517164528124" style="zoom:50%;"></p>
<h4 id="有序索引"><a href="#有序索引" class="headerlink" title="有序索引"></a>有序索引</h4><h5 id="一"><a href="#一" class="headerlink" title="一"></a>一</h5><p>根据数据文件中的元组是否按索引键值排序，分为聚簇索引与非聚簇索引。</p>
<p><strong>聚簇索引</strong></p>
<p>文件中的元组按索引键排序的，则索引为聚簇索引。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">聚簇索引的索引键通常为关系主键；</span><br><span class="line">一个关系通常只有一个聚簇索引</span><br></pre></td></tr></table></figure>
<p><strong>非聚簇索引</strong></p>
<p>文件中的元组不按索引键排序的，则索引为非聚簇索引。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">一个关系上可以有多个非聚簇索引</span><br></pre></td></tr></table></figure>
<p><strong>索引组织表</strong></p>
<p>索引组织表=聚簇索引文件+数据文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在索引组织表中，聚簇索引的索引项中存储元组本身，而不是地址</span><br></pre></td></tr></table></figure>
<h5 id="二"><a href="#二" class="headerlink" title="二"></a>二</h5><p>根据关系中每个元组在索引中是否都有一个对应索引项，可将有序索引分为两类：稠密索引、稀疏索引</p>
<p>稠密索引<img src="/2022/04/19/DBMS/image-20220517165842013.png" alt="image-20220517165842013" style="zoom:50%;"></p>
<p>稀疏索引<img src="/2022/04/19/DBMS/image-20220517165923898.png" alt="image-20220517165923898" style="zoom:50%;"></p>
<h5 id="三"><a href="#三" class="headerlink" title="三"></a>三</h5><p>根据索引键是否为关系的主键，可将有序索引分为两类：主索引，二级索引</p>
<p>主索引</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">索引键为主键；一个关系只有一个</span><br></pre></td></tr></table></figure>
<p>二级索引</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">索引键不是主键：</span><br><span class="line">通常为非聚簇索引，一个关系可以有多个</span><br></pre></td></tr></table></figure>
<h4 id="其他索引及创建方法"><a href="#其他索引及创建方法" class="headerlink" title="其他索引及创建方法"></a>其他索引及创建方法</h4><p>创建主索引：<img src="/2022/04/19/DBMS/image-20220517170535689.png" alt="image-20220517170535689" style="zoom:50%;"></p>
<p>创建二级索引：<img src="/2022/04/19/DBMS/image-20220517170606370.png" alt="image-20220517170606370" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517170620535.png" alt="image-20220517170620535" style="zoom:50%;"></p>
<p>唯一索引：索引键值不能重复<img src="/2022/04/19/DBMS/image-20220517170648750.png" alt="image-20220517170648750" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517170708910.png" alt="image-20220517170708910" style="zoom:50%;"></p>
<p>外键索引<img src="/2022/04/19/DBMS/image-20220517170727013.png" alt="image-20220517170727013" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517170735536.png" alt="image-20220517170735536" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517170745828.png" alt="image-20220517170745828" style="zoom:50%;"></p>
<h4 id="索引结构-1"><a href="#索引结构-1" class="headerlink" title="索引结构"></a>索引结构</h4><p>有序索引结构</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">平衡树</span><br><span class="line">跳表：多用于内存数据库系统</span><br><span class="line">字典树：多用于内存数据库系统</span><br><span class="line">日志结构合并树(LSM-tree)：多用于NoSQL数据库系统的存储引擎</span><br></pre></td></tr></table></figure>
<p>哈希索引数据结构</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">哈希表</span><br></pre></td></tr></table></figure>
<h5 id="哈希索引数据结构"><a href="#哈希索引数据结构" class="headerlink" title="哈希索引数据结构"></a>哈希索引数据结构</h5><p>外存哈希表<img src="/2022/04/19/DBMS/image-20220517171037285.png" alt="image-20220517171037285" style="zoom:50%;"></p>
<p>外存哈希表分类</p>
<p><img src="/2022/04/19/DBMS/image-20220517211355399.png" alt="image-20220517211355399" style="zoom:50%;"></p>
<h6 id="可扩展哈希表"><a href="#可扩展哈希表" class="headerlink" title="可扩展哈希表"></a>可扩展哈希表</h6><p><img src="/2022/04/19/DBMS/image-20220517211456832.png" alt="image-20220517211456832" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517211651367.png" alt="image-20220517211651367" style="zoom:50%;"></p>
<p>插入</p>
<p><img src="/2022/04/19/DBMS/image-20220517212217097.png" alt="image-20220517212217097" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517212500110.png" alt="image-20220517212500110" style="zoom:50%;"></p>
<p>删除<img src="/2022/04/19/DBMS/image-20220517212517570.png" alt="image-20220517212517570" style="zoom:50%;"></p>
<h6 id="线性哈希表"><a href="#线性哈希表" class="headerlink" title="线性哈希表"></a>线性哈希表</h6><p><img src="/2022/04/19/DBMS/image-20220517214121658.png" alt="image-20220517214121658" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517214211543.png" alt="image-20220517214211543" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517214221085.png" alt="image-20220517214221085" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517214245133.png" alt="image-20220517214245133" style="zoom: 50%;"></p>
<p>二者对比</p>
<p><img src="/2022/04/19/DBMS/image-20220517214259200.png" alt="image-20220517214259200" style="zoom:50%;"></p>
<h5 id="树索引结构"><a href="#树索引结构" class="headerlink" title="树索引结构"></a>树索引结构</h5><h6 id="B-树"><a href="#B-树" class="headerlink" title="B+树"></a>B+树</h6><p><img src="/2022/04/19/DBMS/image-20220517214437003.png" alt="image-20220517214437003" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517214541700.png" alt="image-20220517214541700" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517214557404.png" alt="image-20220517214557404" style="zoom:50%;"></p>
<p>B+树插入、删除，看教程，此处不详细说明。</p>
<p>B+树演示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://cmudb.io/btree</span><br></pre></td></tr></table></figure>
<h3 id="其余"><a href="#其余" class="headerlink" title="其余"></a>其余</h3><p>键压缩<img src="/2022/04/19/DBMS/image-20220517214820891.png" alt="image-20220517214820891" style="zoom:50%;"></p>
<p>前缀压缩<img src="/2022/04/19/DBMS/image-20220517214843143.png" alt="image-20220517214843143" style="zoom: 50%;"></p>
<p>后缀截断<img src="/2022/04/19/DBMS/image-20220517214926314.png" alt="image-20220517214926314" style="zoom: 50%;"></p>
<p>批量加载</p>
<p><img src="/2022/04/19/DBMS/image-20220517215000544.png" alt="image-20220517215000544" style="zoom: 50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517215023090.png" alt="image-20220517215023090" style="zoom:50%;"></p>
<h4 id="LSM-Trees"><a href="#LSM-Trees" class="headerlink" title="LSM-Trees"></a>LSM-Trees</h4><p>B+树的原地更新<img src="/2022/04/19/DBMS/image-20220517215143044.png" alt="image-20220517215143044" style="zoom:50%;"></p>
<p>日志结构合并树<img src="/2022/04/19/DBMS/image-20220517215251194.png" alt="image-20220517215251194" style="zoom:50%;"></p>
<p>LSM树的基本结构<img src="/2022/04/19/DBMS/image-20220517215332847.png" alt="image-20220517215332847" style="zoom:50%;"></p>
<p>LSM的查找<img src="/2022/04/19/DBMS/image-20220517215352335.png" alt="image-20220517215352335" style="zoom:50%;"></p>
<p>缺点：当不可变文件非常大时，在文件上查找效率很慢</p>
<p>LSM的更新<img src="/2022/04/19/DBMS/image-20220517215447877.png" alt="image-20220517215447877" style="zoom:50%;"></p>
<p>分层LSM</p>
<p><img src="/2022/04/19/DBMS/image-20220517215513155.png" alt="image-20220517215513155" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517215526939.png" alt="image-20220517215526939" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517215545511.png" alt="image-20220517215545511" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517215827832.png" alt="image-20220517215827832" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517215845457.png" alt="image-20220517215845457" style="zoom:50%;"></p>
<p><strong>位图索引</strong></p>
<p><img src="/2022/04/19/DBMS/image-20220517220627495.png" alt="image-20220517220627495" style="zoom:50%;"></p>
<p><strong>空间索引</strong></p>
<p><img src="/2022/04/19/DBMS/image-20220517220638946.png" alt="image-20220517220638946" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517220649102.png" alt="image-20220517220649102" style="zoom:50%;"></p>
<h2 id="九-查询执行"><a href="#九-查询执行" class="headerlink" title="九.查询执行"></a>九.查询执行</h2><p>查询处理的基本过程</p>
<p><img src="/2022/04/19/DBMS/image-20220427155415469.png" alt="image-20220427155415469" style="zoom:50%;"></p>
<p><strong>原语操作</strong>：带有如何执行注释的关系代数操作。</p>
<p><strong>查询执行计划</strong>：用于执行一个查询的原语操作序列</p>
<p><img src="/2022/04/19/DBMS/image-20220427162137086.png" alt="image-20220427162137086" style="zoom:50%;"></p>
<h3 id="外排"><a href="#外排" class="headerlink" title="外排"></a>外排</h3><p>按照<strong>排序键</strong>对元组进行排序是DBMS非常重要的操作。</p>
<p> 外排序<img src="/2022/04/19/DBMS/image-20220517222109387.png" alt="image-20220517222109387" style="zoom:50%;"></p>
<h4 id="两趟多路外存归并排序"><a href="#两趟多路外存归并排序" class="headerlink" title="两趟多路外存归并排序"></a>两趟多路外存归并排序</h4><p>第一阶段：创建归并段</p>
<p>第二阶段：归并</p>
<p>记法<img src="/2022/04/19/DBMS/image-20220517222433566.png" alt="image-20220517222433566" style="zoom:50%;"></p>
<p>创建归并段<img src="/2022/04/19/DBMS/image-20220517222516708.png" alt="image-20220517222516708" style="zoom:50%;"></p>
<p>演示看PPT</p>
<p>算法分析<img src="/2022/04/19/DBMS/image-20220517222852523.png" alt="image-20220517222852523" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517222904328.png" alt="image-20220517222904328" style="zoom:50%;"></p>
<h4 id="多趟多路外存归并排序"><a href="#多趟多路外存归并排序" class="headerlink" title="多趟多路外存归并排序"></a>多趟多路外存归并排序</h4><p><img src="/2022/04/19/DBMS/image-20220517230415632.png" alt="image-20220517230415632" style="zoom:50%;"></p>
<p>优化</p>
<p><img src="/2022/04/19/DBMS/image-20220517231952042.png" alt="image-20220517231952042" style="zoom:50%;"></p>
<p>双缓冲<img src="/2022/04/19/DBMS/image-20220517232002315.png" alt="image-20220517232002315" style="zoom:50%;"></p>
<h3 id="关系代数操作的执行"><a href="#关系代数操作的执行" class="headerlink" title="关系代数操作的执行"></a>关系代数操作的执行</h3><h4 id="选择操作的执行"><a href="#选择操作的执行" class="headerlink" title="选择操作的执行"></a>选择操作的执行</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.基于扫描的选择算法</span><br><span class="line">2.基于哈希的选择算法</span><br><span class="line">3.基于索引的选择算法</span><br></pre></td></tr></table></figure>
<p>记法<img src="/2022/04/19/DBMS/image-20220517232147225.png" alt="image-20220517232147225" style="zoom:50%;"></p>
<h5 id="基于扫描的选择算法"><a href="#基于扫描的选择算法" class="headerlink" title="基于扫描的选择算法"></a>基于扫描的选择算法</h5><p><img src="/2022/04/19/DBMS/image-20220517232244556.png" alt="image-20220517232244556" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517232257592.png" alt="image-20220517232257592" style="zoom:50%;"></p>
<h5 id="基于哈希的选择算法"><a href="#基于哈希的选择算法" class="headerlink" title="基于哈希的选择算法"></a>基于哈希的选择算法</h5><p>前提<img src="/2022/04/19/DBMS/image-20220517232530302.png" alt="image-20220517232530302" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517232543905.png" alt="image-20220517232543905" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517232551718.png" alt="image-20220517232551718" style="zoom:50%;"></p>
<h5 id="基于索引的选择算法"><a href="#基于索引的选择算法" class="headerlink" title="基于索引的选择算法"></a>基于索引的选择算法</h5><p>前提<img src="/2022/04/19/DBMS/image-20220517232646680.png" alt="image-20220517232646680" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517232703167.png" alt="image-20220517232703167" style="zoom:50%;"></p>
<h4 id="投影操作-1"><a href="#投影操作-1" class="headerlink" title="投影操作"></a>投影操作</h4><p><img src="/2022/04/19/DBMS/image-20220517233036625.png" alt="image-20220517233036625" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220517233052558.png" alt="image-20220517233052558" style="zoom:50%;"></p>
<h4 id="去重操作"><a href="#去重操作" class="headerlink" title="去重操作"></a>去重操作</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.一趟去重算法</span><br><span class="line">2.基于排序的去重算法</span><br><span class="line">3.基于哈希的去重算法</span><br></pre></td></tr></table></figure>
<h5 id="一趟去重算法"><a href="#一趟去重算法" class="headerlink" title="一趟去重算法"></a>一趟去重算法</h5><p><img src="/2022/04/19/DBMS/image-20220518000726368.png" alt="image-20220518000726368" style="zoom:50%;"></p>
<p>可在内存中用哈希表记录见过的元组，哈希键为整个元组。</p>
<p><img src="/2022/04/19/DBMS/image-20220518000816527.png" alt="image-20220518000816527" style="zoom:50%;"></p>
<h5 id="基于排序的去重算法"><a href="#基于排序的去重算法" class="headerlink" title="基于排序的去重算法"></a>基于排序的去重算法</h5><p><img src="/2022/04/19/DBMS/image-20220518000924102.png" alt="image-20220518000924102" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220518000947953.png" alt="image-20220518000947953" style="zoom:50%;"></p>
<h5 id="基于哈希的去重算法"><a href="#基于哈希的去重算法" class="headerlink" title="基于哈希的去重算法"></a>基于哈希的去重算法</h5><p><img src="/2022/04/19/DBMS/image-20220518001143515.png" alt="image-20220518001143515" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220518001212003.png" alt="image-20220518001212003" style="zoom:50%;"></p>
<h4 id="聚集操作的执行"><a href="#聚集操作的执行" class="headerlink" title="聚集操作的执行"></a>聚集操作的执行</h4><p>与去重一样</p>
<p><img src="/2022/04/19/DBMS/image-20220518001258445.png" alt="image-20220518001258445" style="zoom:50%;"></p>
<h4 id="集合差操作的执行"><a href="#集合差操作的执行" class="headerlink" title="集合差操作的执行"></a>集合差操作的执行</h4><p><img src="/2022/04/19/DBMS/image-20220518001319436.png" alt="image-20220518001319436" style="zoom:50%;"></p>
<h5 id="一趟集合差算法"><a href="#一趟集合差算法" class="headerlink" title="一趟集合差算法"></a>一趟集合差算法</h5><p><img src="/2022/04/19/DBMS/image-20220518001713665.png" alt="image-20220518001713665" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220518001802445.png" alt="image-20220518001802445" style="zoom:50%;"></p>
<h5 id="基于哈希的集合差算法"><a href="#基于哈希的集合差算法" class="headerlink" title="基于哈希的集合差算法"></a>基于哈希的集合差算法</h5><p><img src="/2022/04/19/DBMS/image-20220518001829640.png" alt="image-20220518001829640" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220518001850144.png" alt="image-20220518001850144" style="zoom:50%;"></p>
<h5 id="基于排序的集合差算法"><a href="#基于排序的集合差算法" class="headerlink" title="基于排序的集合差算法"></a>基于排序的集合差算法</h5><p><img src="/2022/04/19/DBMS/image-20220518001912214.png" alt="image-20220518001912214" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220518001939501.png" alt="image-20220518001939501" style="zoom:50%;"></p>
<h4 id="连接操作的执行"><a href="#连接操作的执行" class="headerlink" title="连接操作的执行"></a>连接操作的执行</h4><p><img src="/2022/04/19/DBMS/image-20220518002200543.png" alt="image-20220518002200543" style="zoom:50%;"></p>
<h5 id="一趟连接算法"><a href="#一趟连接算法" class="headerlink" title="一趟连接算法"></a>一趟连接算法</h5><p><img src="/2022/04/19/DBMS/image-20220518002350004.png" alt="image-20220518002350004" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220518002448925.png" alt="image-20220518002448925" style="zoom:50%;"></p>
<h5 id="基于元组的嵌套循环连接"><a href="#基于元组的嵌套循环连接" class="headerlink" title="基于元组的嵌套循环连接"></a>基于元组的嵌套循环连接</h5><p><img src="/2022/04/19/DBMS/image-20220518002515100.png" alt="image-20220518002515100" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220518002602850.png" alt="image-20220518002602850" style="zoom:50%;"></p>
<p><strong>基于块的嵌套循环连接</strong></p>
<p><img src="/2022/04/19/DBMS/image-20220518002627601.png" alt="image-20220518002627601" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220518002659923.png" alt="image-20220518002659923" style="zoom:50%;"></p>
<h5 id="排序归并连接"><a href="#排序归并连接" class="headerlink" title="排序归并连接"></a>排序归并连接</h5><p><img src="/2022/04/19/DBMS/image-20220518002717370.png" alt="image-20220518002717370" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220518002834171.png" alt="image-20220518002834171" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220518002855040.png" alt="image-20220518002855040" style="zoom:50%;"></p>
<h5 id="经典哈希连接"><a href="#经典哈希连接" class="headerlink" title="经典哈希连接"></a>经典哈希连接</h5><p><img src="/2022/04/19/DBMS/image-20220518002921364.png" alt="image-20220518002921364" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220518002938211.png" alt="image-20220518002938211" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220518002946745.png" alt="image-20220518002946745" style="zoom:50%;"></p>
<h5 id="索引连接"><a href="#索引连接" class="headerlink" title="索引连接"></a>索引连接</h5><p><img src="/2022/04/19/DBMS/image-20220518002958713.png" alt="image-20220518002958713" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220518003033410.png" alt="image-20220518003033410" style="zoom:50%;"></p>
<h3 id="查询计划的执行方法"><a href="#查询计划的执行方法" class="headerlink" title="查询计划的执行方法"></a>查询计划的执行方法</h3><p><img src="/2022/04/19/DBMS/image-20220518003117091.png" alt="image-20220518003117091" style="zoom:50%;"></p>
<h4 id="物化执行"><a href="#物化执行" class="headerlink" title="物化执行"></a>物化执行</h4><p><img src="/2022/04/19/DBMS/image-20220518003143221.png" alt="image-20220518003143221" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220518003152780.png" alt="image-20220518003152780" style="zoom:50%;"></p>
<h4 id="流水线执行"><a href="#流水线执行" class="headerlink" title="流水线执行"></a>流水线执行</h4><p><img src="/2022/04/19/DBMS/image-20220518003224150.png" alt="image-20220518003224150" style="zoom:50%;"></p>
<p>迭代器模型</p>
<p><img src="/2022/04/19/DBMS/image-20220518003921085.png" alt="image-20220518003921085" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220518003946545.png" alt="image-20220518003946545" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220518004014141.png" alt="image-20220518004014141" style="zoom:50%;"></p>
<p><img src="/2022/04/19/DBMS/image-20220518004026684.png" alt="image-20220518004026684" style="zoom:50%;"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/18/%E7%A2%B3%E6%8E%92%E6%94%BE%E9%87%8F%E7%BB%9F%E8%AE%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/18/%E7%A2%B3%E6%8E%92%E6%94%BE%E9%87%8F%E7%BB%9F%E8%AE%A1/" class="post-title-link" itemprop="url">碳排放量统计</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-04-18 19:34:28 / Modified: 21:10:56" itemprop="dateCreated datePublished" datetime="2022-04-18T19:34:28+08:00">2022-04-18</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="碳排放量数据统计"><a href="#碳排放量数据统计" class="headerlink" title="碳排放量数据统计"></a>碳排放量数据统计</h1><p>14-19年可通过CEAD获取</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.ceads.net.cn/news/20211256.html</span><br></pre></td></tr></table></figure>
<p>1990-2015年的数据，可以通过MEIC获取</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://meicmodel.org/?page_id=560</span><br></pre></td></tr></table></figure>
<p>注：MEIC可以获取碳排放量统计图片</p>
<p>对于之后的数据获取方法：</p>
<p>法一：</p>
<p>通过</p>
<p><a href="https://link.zhihu.com/?target=http%3A//www.wheata.cn/">WheatA小麦芽 - 农业气象大数据</a></p>
<p>例如想知道杭州城区历年的二氧化碳排放量有多少，如图所示。</p>
<p><img src="/2022/04/18/%E7%A2%B3%E6%8E%92%E6%94%BE%E9%87%8F%E7%BB%9F%E8%AE%A1/image-20220418201114279.png" alt="image-20220418201114279"></p>
<p>图1显示的是一个全球大气污染排放数据调用界面，我们把坐标定位到杭州城区东站附近（坐标：120.15°E，30.35°N），获取该地2020年逐月的CO2排放量数据，如图所示。</p>
<p><img src="/2022/04/18/%E7%A2%B3%E6%8E%92%E6%94%BE%E9%87%8F%E7%BB%9F%E8%AE%A1/image-20220418201138181.png" alt="image-20220418201138181"></p>
<p>图2显示了<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=杭州市&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra={&quot;sourceType&quot;%3A&quot;answer&quot;%2C&quot;sourceId&quot;%3A2098680812}">杭州市</a>中心地段2020年逐月的CO2排放量，可以看到2020年1月该地区CO2总排放量为3.9kg/m2，按杭州城区面积560平方公里算，可推测出2020年1月城区二氧化碳总排放量约为200万吨。</p>
<p>法二：</p>
<p>根据各省市统计年鉴计算。</p>
<p>如果用IPCC的算法的话，一般情况下用的都是能源平衡表，也就是用终端消费量来算各种能源的二氧化碳排放量。</p>
<p>挂一个可能有用的网站，碳排放交易网。</p>
<p>法三：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.csdn.net/samLi0620/article/details/123499971</span><br></pre></td></tr></table></figure>
<p>1997-2020年（其中2018-2020年为插值法估计）</p>
<p>(29.9元)</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/14/%E4%BB%BB%E5%8A%A1%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/14/%E4%BB%BB%E5%8A%A1%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">任务管理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-04-14 18:39:21" itemprop="dateCreated datePublished" datetime="2022-04-14T18:39:21+08:00">2022-04-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-04-15 16:46:32" itemprop="dateModified" datetime="2022-04-15T16:46:32+08:00">2022-04-15</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="任务管理"><a href="#任务管理" class="headerlink" title="任务管理"></a>任务管理</h1><h2 id="任务管理概述"><a href="#任务管理概述" class="headerlink" title="任务管理概述"></a>任务管理概述</h2><p>一个任务是一个处理器可以调度、执行和暂停的工作单位。它可以用来执行一个程序，一个任务或进程，一个操作系统服务工具，一个中断或异常处理程序，或一个内核或执行实用程序。</p>
<p>IA-32结构提供了一种机制，用于保存任务的状态，调度任务的执行，以及从一个任务切换到另一个任务。当在保护模式下运行时，所有的处理器执行都是在任务内进行的，即使是简单的系统也必须至少定义一个任务。更复杂的系统可以使用处理器的任务管理设施来支持多任务的应用。</p>
<p>一个过程调用包括将数据（以<strong>参数</strong>和<strong>返回值</strong>的形式）与控制从代码的一部分传递到另一部分。除此之外，在进入时为过程的局部变量分配空间，在退出的时候释放这些空间。数据传递、局部变量的分配和释放通过操纵程序栈来实现。</p>
<p>操作系统实现宏观上并行任务的效果，其本质是微观上在多个任务之间切换。因此，当操作系统由任务A切换到任务B时，需要暂停任务A的执行，并将处理器执行任务A时各个寄存器的值保存到内存的某个位置上，这个过程叫做保存现场；之后将处理器上一次执行任务B时各个寄存器的值由内存中的某个位置回复到处理的寄存器当中，这个过程叫做恢复现场。当操作系统在调度时由任务A切换到任务B时，对任务A保存现场，对任务B恢复现场，这个整体的过程称之为：上下文切换。</p>
<p>在每一个任务在执行之前，操作系统都需要为其分配一个专属的内存区域供其使用，这个内存区域通常被称为此任务的栈（stack）。Cortex-M有两个堆栈寄存器，主栈指针（MSP）与进程栈指针（PSP）。主程序操作系统和各个中断函数使用的是MSP指针，而各个被调度的任务（进程）使用的是PSP指针。本质上它是处理器的一个寄存器，PSP寄存器的值就是内存中任务的栈地址。</p>
<h3 id="任务的结构"><a href="#任务的结构" class="headerlink" title="任务的结构"></a>任务的结构</h3><p>一个任务由两部分组成：一个任务执行空间和一个任务状态段（TSS）。任务执行空间由一个代码段、一个堆栈段和一个或多个数据段组成（见图7-1）。如果操作系统或执行程序使用处理器的特权级别保护机制，任务执行空间也会为每个特权提供一个单独的堆栈。<br>TSS指定了组成任务执行空间的段，并为任务状态信息提供了一个存储位置信息。在多任务系统中，TSS还提供了一种连接任务的机制。<br>一个任务由其TSS的段选择器来识别。当一个任务被加载到处理器中执行时，它的段选择器、基地址、限制和段描述符属性被加载到任务的寄存器。如果任务实现了分页，任务所使用的页面目录的基地址被加载到控制寄存器CR3。</p>
<p><img src="/2022/04/14/%E4%BB%BB%E5%8A%A1%E7%AE%A1%E7%90%86/image-20220414193049801.png" alt="image-20220414193049801"></p>
<h3 id="任务状态"><a href="#任务状态" class="headerlink" title="任务状态"></a>任务状态</h3><p>以下项目定义了当前执行的任务的状态：</p>
<ul>
<li>任务的当前执行空间，由段寄存器（CS、DS、SS、ES、GS、FS和GS）中的段选择器定义。</li>
<li>通用寄存器的状态。</li>
<li>EFLAGS寄存器的状态。</li>
<li>EIP寄存器的状态。</li>
<li>控制寄存器CR3的状态。</li>
<li>任务寄存器的状态。</li>
<li>LDTR寄存器的状态。</li>
<li>I/O地图的基址和I/O地图（包含在TSS中）。</li>
<li>特权0、1和2堆栈的堆栈指针（包含在TSS中）。</li>
<li>与先前执行的任务的链接（包含在TSS中）。<br>在调度任务之前，所有这些项目都包含在任务的TSS中，除了任务寄存器的状态。另外，LDTR寄存器的全部内容不包含在TSS中，只有LDT的段选择器。</li>
</ul>
<h3 id="任务的执行"><a href="#任务的执行" class="headerlink" title="任务的执行"></a>任务的执行</h3><p>软件或处理器可以通过以下方式之一调度一个任务的执行。</p>
<ul>
<li>用CALL指令明确调用一个任务。</li>
<li>用JMP指令显式跳转到一个任务。</li>
<li>隐式调用（由处理器）到一个中断处理任务。</li>
<li>对一个异常处理任务的隐式调用。</li>
<li>当EFLAGS寄存器中的NT标志被设置时，返回（用IRET指令启动）。</li>
</ul>
<p>所有这些调度任务的方法都是用一个段选择器来识别要调度的任务，这个段选择器指向任务门或任务的TSS。当用CALL或JMP指令调度任务时，指令中的选择器可以直接选择TSS或持有TSS的选择器的任务门。当调度一个任务来处理一个中断或异常时，中断或异常的IDT条目必须包含一个任务门，它持有中断或异常处理程序TSS的选择器。<br>当一个任务被调度执行时，在当前运行的任务和被调度的任务之间会发生一个任务切换。在任务切换期间，当前执行的任务的执行环境（称为任务的状态或上下文）被保存在其TSS中，任务的执行被暂停。被派遣任务的上下文被加载到处理器中，该任务的执行从新加载的EIP寄存器所指向的指令开始。如果任务在系统上次初始化后没有运行过，EIP将指向任务代码的第一条指令；否则，它将指向任务最后执行的指令之后的下一条指令。<br>如果当前执行的任务（调用任务）调用了被派发的任务（被调用任务），则段选择器被存储在被调用任务的TSS中，以提供与调用任务的链接。<br>对于所有IA-32处理器，任务不是递归的。一个任务不能调用或跳转到自身。中断和异常可以通过任务切换到一个处理任务来处理。在这里，处理器执行一个任务来处理中断或异常，从中断处理任务或异常处理任务返回后，自动切换回被中断的任务。这种机制也可以处理在中断任务中发生的中断。<br>作为任务切换的一部分，处理器也可以切换到另一个LDT，允许每个任务对基于LDT的段有不同的逻辑到物理地址的映射。在任务切换时，页面目录基础寄存器（CR3）也被重新加载，允许每个任务有它自己的一套页表。这些保护设施有助于隔离任务并防止它们相互干扰。<br>如果不使用保护机制，处理器不提供任务之间的保护。这一点即使在操作系统也是如此，该系统使用多个特权级别进行保护。一个运行在特权级别3的任务，使用与其他任务相同的LDT和页表。</p>
<h2 id="任务的数据结构"><a href="#任务的数据结构" class="headerlink" title="任务的数据结构"></a>任务的数据结构</h2><p>处理器定义了五个数据结构来处理与任务有关的活动。</p>
<ul>
<li>任务状态段（TSS）。</li>
<li>任务门描述符。</li>
<li>TSS描述符。</li>
<li>任务寄存器。</li>
<li>EFLAGS寄存器中的NT标志。</li>
</ul>
<p>当在保护模式下运行时，必须为至少一个任务创建一个TSS和TSS描述符，并且TSS的段选择器必须被加载到任务寄存器中（使用LTR指令）。</p>
<h3 id="任务状态段-Task-State-Segment-TSS"><a href="#任务状态段-Task-State-Segment-TSS" class="headerlink" title="任务状态段 Task-State Segment (TSS)"></a>任务状态段 Task-State Segment (TSS)</h3><p>恢复一个任务所需的处理器状态信息被保存在一个叫做任务状态段（TSS）的系统段中。图7-2显示了为32位CPU设计的任务的TSS的格式。TSS的字段被分为两个主要类别：动态字段和静态字段。<br><img src="/2022/04/14/%E4%BB%BB%E5%8A%A1%E7%AE%A1%E7%90%86/image-20220414195850785.png" alt="image-20220414195850785"></p>
<p>在任务切换期间，当一个任务被暂停时，处理器会更新动态字段。以下是动态字段。</p>
<ul>
<li>通用寄存器字段 - EAX, ECX, EDX, EBX, ESP, EBP, ESI, 和 EDI 寄存器在任务切换前的状态。</li>
<li>分段选择器字段—在任务切换前存储在ES、CS、SS、DS、FS和GS寄存器中的分段选择器。</li>
<li>EFLAGS寄存器字段 - 任务切换前EFAGS寄存器的状态。</li>
<li>EIP（指令指针）字段 - 任务切换前EIP寄存器的状态。</li>
<li>前一个任务链接字段—包含前一个任务的TSS的段选择器（在由调用、中断或异常启动的任务切换中更新）。这个字段（有时被称为后端链接字段）允许通过使用IRET指令将任务切换到前一个任务。处理器读取静态字段，但通常不改变它们。这些字段是在一个任务被创建时设置的。<br>以下是静态字段。</li>
<li>LDT段选择器字段 - 包含任务的LDT的段选择器。</li>
<li>CR3控制寄存器字段 - 包含任务要使用的页面目录的基本物理地址。控制寄存器CR3也被称为页面目录基础寄存器（PDBR）。</li>
<li>权限级别-0、-1和-2的堆栈指针字段—这些堆栈指针包括一个逻辑地址，由堆栈段的段选择器（SS0、SS1和SS2）和堆栈的偏移量（ESP0, ESP1和ESP2）组成。注意，这些字段的值对于一个特定的任务来说是静态的；而SS和ESP的值会在任务中发生堆栈切换时改变。</li>
<li>T（调试陷阱）标志（字节100，位0）—当设置时，T标志会使处理器在任务切换到这个任务时引发一个调试异常。</li>
<li>I/O地图基址字段 - 包含从TSS的基点到I/O权限位的图和中断重定向位图的16位偏移。当存在时，这些地图以更高的地址存储在TSS中。</li>
<li>避免在处理器在任务切换时读取的TSS部分（前104字节）放置页面边界。如果边界出现在这个区域，处理器可能无法正确执行地址转换。在任务切换过程中，处理器在每个TSS的前104个字节中进行读写（使用连续的物理地址，从任务的物理地址开始）。所以，在TSS访问开始后，如果104字节中的一部分 不是物理上连续的，处理器将访问不正确的信息，而不会产生页面错误异常。</li>
<li>与前一个任务的TSS、当前任务的TSS相对应的页面，以及每个任务的描述符表项都应该被标记为读/写。</li>
</ul>
<p>如果包含这些结构的页面在任务切换开始前就已经存在于内存中，那么任务切换的速度会更快。</p>
<h3 id="TSS-描述符"><a href="#TSS-描述符" class="headerlink" title="TSS 描述符"></a>TSS 描述符</h3><p>TSS，像所有其他段一样，是由段描述符定义的。图7-3显示了TSS的格式 。TSS描述符只能放在GDT中，它们不能放在LDT或IDT中。<br>试图使用设置了TI标志（表示当前的LDT）的段选择器访问一个TSS，会导致在CALLs和JMPs期间会产生一个一般保护异常（#GP）；在IRETs期间会产生一个无效的TSS异常（#TS）。如果试图将一个TSS的段选择器加载到一个段寄存器中，也会产生一般保护异常。<br>类型字段中的繁忙标志（B）表示任务是否繁忙。一个繁忙的任务目前正在运行或暂停。类型字段的值为1001B表示一个不活动的任务；值为1011B表示一个繁忙的任务。<br>处理器使用繁忙标志来检测调用一个执行被中断的任务的尝试。为了确保只有一个繁忙标志与一个任务相关联，每个TSS应该只有一个TSS描述符指向它。</p>
<p><img src="/2022/04/14/%E4%BB%BB%E5%8A%A1%E7%AE%A1%E7%90%86/image-20220414201925534.png" alt="image-20220414201925534"></p>
<p>基数、极限和DPL字段以及粒度和当前标志的功能与它们在数据段描述符中的使用类似。当32位TSS描述符中的G标志为0时，极限字段必须是32位TSS描述符中的极限。TSS描述符中G标志为0时，极限字段的值必须等于或大于67H，比TSS的最小尺寸少一个字节。<br>试图切换到一个TSS描述符的极限值小于67H的任务，会产生一个无效的TSS异常（#TS）。如果包括一个I/O权限位图或操作系统存储了额外的数据，则需要一个更大的限制。处理器不检查任务开关上是否有大于67H的限制；但是，当访问I/O权限位图或中断重定向位图时，它将进行检查。<br>任何可以访问TSS描述符的程序或过程（即其CPL在数字上等于或小于的DPL）可以通过调用或跳转来调度任务。<br>在大多数系统中，TSS描述符的DPL被设置为小于3的值，因此只有特权软件才能进行任务切换。然而，在多任务应用程序中，一些TSS描述符的DPLs可能被设置为3，以便允许在应用程序（或用户）权限级别进行任务切换。</p>
<h3 id="任务寄存器"><a href="#任务寄存器" class="headerlink" title="任务寄存器"></a>任务寄存器</h3><p>任务寄存器持有16位段选择器和整个段描述符（32位基本地址（在IA-32e模式下为64位 ），16位段限制和描述符属性），用于当前任务的TSS。<br>这个信息是从当前任务的GDT中的TSS描述符中复制过来的。图7-5显示了处理器访问TSS的路径 （使用任务寄存器中的信息）。任务寄存器有一个可见的部分（可以被软件读取和改变）和一个不可见的部分（由处理器维护，不能访问）。可见部分的段选择器指向GDT中的一个TSS描述符。处理器使用任务寄存器的不可见部分来缓存段描述符 。在寄存器中缓存这些值使得任务的执行更加有效。LTR（加载任务<br>寄存器）和STR（存储任务寄存器）指令加载和读取任务寄存器的可见部分。<br>LTR指令将段选择器（源操作数）加载到任务寄存器中，指向GDT中的TSS描述符。然后它用TSS描述符的信息加载任务寄存器的不可见部分。LTR是一个 特权指令，只有当CPL为0时才能执行。之后，当任务切换发生时，任务寄存器的内容会被隐含地改变。<br>STR(存储任务寄存器)指令将任务寄存器的可见部分存储在一个通用寄存器或内存中。这条指令可以被运行在任何权限级别的代码执行，以识别当前的运行的任务。然而，它通常只被操作系统软件使用。在处理器上电或复位时，段选择器和基地址被设置为默认值0；极限值<br>被设置为FFFH。</p>
<p><img src="/2022/04/14/%E4%BB%BB%E5%8A%A1%E7%AE%A1%E7%90%86/image-20220414203302131.png" alt="image-20220414203302131"></p>
<h3 id="任务门描述符"><a href="#任务门描述符" class="headerlink" title="任务门描述符"></a>任务门描述符</h3><p>任务门描述符提供了对一个任务的间接的、受保护的引用（见图7-6）。它可以被放置在GDT、LDT或IDT中。任务门描述符中的TSS段选择器字段指向GDT中的一个TSS描述符。该段选择器中的RPL不被使用。任务门描述符的DPL在任务切换期间控制对TSS描述符的访问。当一个程序或过程通过任务门调用或跳转到一个任务时，指向任务门的门选择器的CPL和RPL域必须小于或等于任务门描述符的DPL。请注意，当任务门被使用时 ，目标TSS描述符的DPL不被使用。</p>
<p><img src="/2022/04/14/%E4%BB%BB%E5%8A%A1%E7%AE%A1%E7%90%86/image-20220414204423254.png" alt="image-20220414204423254"></p>
<p>一个任务可以通过一个任务门描述符或一个TSS描述符来访问。这两种结构都满足以下需求。</p>
<ul>
<li>一个任务只需要一个繁忙标志 - 因为一个任务的繁忙标志是存储在TSS描述符中，每个任务应该只有一个TSS描述符。然而，可能有几个任务门会引用同一个TSS描述符。</li>
<li>需要提供对任务的选择性访问—任务门满足这一需求，因为它们可以驻留在一个LDT中，并且可以有一个与TSS描述符的DPL不同的DPL。一个程序或过程如果没有足够的权限访问GDT中任务的TSS描述符（通常DPL为0）的程序或过程可以通过一个具有更高DPL的任务门来访问该任务。任务门给了操作系统更大的限制对特定任务的访问的自由度。</li>
<li>需要一个独立的任务来处理中断或异常 - 任务门也可以驻留在IDT中。在IDT中，它允许中断和异常由处理任务来处理。当一个中断或异常向量指向一个任务门时，处理器会切换到指定的任务。图7-7说明了LDT中的任务门、GDT中的任务门和IDT中的任务门如何都能指向同一个任务。</li>
</ul>
<p><img src="/2022/04/14/%E4%BB%BB%E5%8A%A1%E7%AE%A1%E7%90%86/image-20220414210542784.png" alt="image-20220414210542784"></p>
<h2 id="任务切换"><a href="#任务切换" class="headerlink" title="任务切换"></a>任务切换</h2><p>处理器在四种情况中的一种将执行转移到另一个任务。</p>
<ul>
<li>当前程序、任务或过程执行JMP或CALL指令到GDT中的TSS描述符。</li>
<li>当前程序、任务或过程执行JMP或CALL指令到GDT或当前LDT中的任务门描述符。</li>
<li>中断或异常向量指向IDT中的一个任务门描述符。</li>
<li>当EFLAGS寄存器中的NT标志被设置时，当前任务执行一个IRET。JMP、CALL和IRET指令，以及中断和异常，都是重定向程序的机制。对TSS描述符或任务门的引用（当调用或跳转到一个任务时）或NT标志的状态（当执行IRET时）都是重定向的机制。NT标志的状态（执行IRET指令时）决定是否发生任务切换。当切换到一个新的任务时，处理器会执行以下操作：</li>
</ul>
<ol>
<li>获得新任务的TSS段选择器，作为JMP或CALL指令的操作数，从任务门或前一个任务链接字段（对于用IRET指令启动的任务切换）获得新任务的TSS段选择器。</li>
<li>检查当前（旧）任务是否被允许切换到新任务。数据访问权限规则适用于JMP和CALL指令。当前（旧）任务的CPL和新任务的段选择器的RPL必须小于或等于被引用的TSS描述符或任务门的DPL。例外的情况，中断（由INT n指令产生的中断除外）和IRET指令被允许切换任务，而不考虑TSS描述符的DPL。对于INT n指令产生的中断，要检查DPL。</li>
<li>检查新任务的TSS描述符是否被标记为存在，并且有一个有效的限制（大于或等于67H）。</li>
<li>检查新任务是否可用（调用、跳转、异常或中断）或繁忙（IRET返回）。</li>
<li>检查当前（旧）TSS、新TSS和任务切换中使用的所有段描述符是否被分页到系统内存中。</li>
<li>如果任务切换是由JMP或IRET指令启动的，处理器将清除当前（旧）任务的TSS中的忙（B）标志；如果用CALL指令、异常或中断启动：忙（B）标志保持不变。</li>
<li>如果任务切换是由IRET指令启动的，处理器将清除EFLAGS寄存器中临时保存的NT标志；如果是由CALL或JMP指令、异常或中断启动的，则NT标志在EFLAGS寄存器中保持不变。</li>
<li>在当前任务的TSS中保存当前（旧）任务的状态。处理器在任务寄存器中找到当前TSS的基地址 ，然后将下列寄存器的状态复制到当前的TSS中：所有的通用寄存器，段寄存器中的段选择器，临时保存的EFLAGS寄存器的映像，以及指令指针寄存器（EIP）。</li>
<li>如果任务切换是由CALL指令、异常或中断启动的，处理器将设置EFLAGS寄存器中的NT标志。如果是用IRET指令或JMP指令启动的，NT标志将反映新任务中加载的EFLAGS的NT状态（见表7-2）。</li>
<li>如果任务切换是由CALL指令、JMP指令、异常或中断启动的，处理器就会在新任务的TSS描述符中设置繁忙(B)标志；如果是由IRET指令启动的，繁忙(B)标志就保持不变。</li>
<li>用段选择器和新任务的TSS的描述符加载任务寄存器。</li>
<li>TSS状态被加载到处理器中。这包括LDTR寄存器，PDBR(控制寄存器CR3)，EFLAGS寄存器，EFLAGS寄存器，<br>EIP寄存器，通用寄存器，以及段选择器。在这个状态的加载过程中出现的故障可能会破坏架构状态。(如果没有启用分页，PDBR值会从新任务的TSS中读出，但它不会被加载到CR3中）。</li>
<li>与段选择器相关的描述符被加载和限定。与此相关的任何错误都发生在新任务的上下文中，并可能破坏架构状态。</li>
</ol>
<p><strong>注意事项</strong><br>如果所有的检查和保存都成功进行了，处理器就会提交给任务开关。如果在步骤1到11中发生了不可恢复的错误，处理器不会完成任务切换，并确保处理器返回到执行启动任务切换的指令之前的状态。<br>如果一个不可恢复的错误发生在步骤12，架构状态可能会被破坏，但会试图将在先前的执行环境中处理该错误。如果一个不可恢复的错误发生在提交点之后（在步骤13），处理器完成了任务切换（不执行额外的访问和段可用性检查），并在开始执行新的任务之前产生适当的异常。<br>如果异常发生在提交点之后，异常处理程序必须完成任务切换本身然后才允许处理器开始执行新的任务。</p>
<ol>
<li>开始执行新任务。(对于异常处理程序来说，新任务的第一条指令似乎没有被执行）。</li>
</ol>
<p>当一个成功的任务切换发生时，当前执行的任务的状态总是被保存。如果该任务被恢复 ，执行将从保存的EIP值所指向的指令开始，并且寄存器被恢复到 任务暂停时的值。<br>当切换任务时，新任务的权限级别不会继承被暂停的任务的权限级别。新的任务以CS寄存器的CPL字段中指定的权限级别开始执行，CS寄存器是由TSS加载的。因为任务被它们独立的地址空间和TSS所隔离，并且因为特权规则控制对TSS的访问，所以任务在执行时，需要有足够的权限。<br>表7-1显示了处理器在切换任务时检查的异常条件。它还显示了如果检测到错误，每个检查都会产生异常，以及错误代码所引用的段。<br><img src="/2022/04/14/%E4%BB%BB%E5%8A%A1%E7%AE%A1%E7%90%86/image-20220414215039998.png" alt="image-20220414215039998"></p>
<p><img src="/2022/04/14/%E4%BB%BB%E5%8A%A1%E7%AE%A1%E7%90%86/image-20220414215048323.png" alt="image-20220414215048323"></p>
<p><strong>注意</strong></p>
<ol>
<li><h1 id="NP是段不存在异常，-GP是一般保护异常，-TS是无效TSS异常，-SS是堆栈故障异常。"><a href="#NP是段不存在异常，-GP是一般保护异常，-TS是无效TSS异常，-SS是堆栈故障异常。" class="headerlink" title="NP是段不存在异常，#GP是一般保护异常，#TS是无效TSS异常，#SS是堆栈故障异常。"></a>NP是段不存在异常，#GP是一般保护异常，#TS是无效TSS异常，#SS是堆栈故障异常。</h1></li>
<li>错误代码包含了这一列中引用的段描述符的索引。</li>
<li>如果一个段选择器在一个兼容类型的表中（GDT或LDT），在表的段限制内占据一个地址，那么它是有效的。<br>并且指向兼容的描述符类型（例如，CS寄存器中的段选择器只有当它指向代码段描述符时才有效）。</li>
</ol>
<p>每次发生任务切换时，控制寄存器CR0中的TS（任务切换）标志被设置。在产生浮点异常时，系统软件使用TS标志来协调浮点单元与处理器其他部分的行动。</p>
<h2 id="任务链"><a href="#任务链" class="headerlink" title="任务链"></a>任务链</h2><p>TSS的前一个任务链接字段（有时称为 “反向链接”）和EFLAGS寄存器中的NT标志被用来返回到前一个任务的执行。EFLAGS.NT=1表示当前执行的任务被嵌套在另一个任务的执行中。<br>当CALL指令、中断或异常导致任务切换时：处理器将当前TSS的选择器复制到新任务的TSS的前一个任务链接字段；然后设置EFLAGS.NT=1。如果软件使用IRET指令来暂停新任务，处理器检查EFLAGS.NT=1；然后使用<br>它使用前一个任务链接字段中的值来返回到前一个任务。见图7-8。<br>当JMP指令引起任务切换时，新任务不被嵌套。前一个任务链接字段不被使用，并且EFLAGS.NT=0。当不需要嵌套时，使用JMP指令来调度一个新任务。</p>
<p><img src="/2022/04/14/%E4%BB%BB%E5%8A%A1%E7%AE%A1%E7%90%86/image-20220415161736123.png" alt="image-20220415161736123"></p>
<p>表7-2显示了任务切换过程中的繁忙标志（在TSS段描述符中）、NT标志、前一个任务链接字段和TS标志(在控制寄存器CR0中)在任务切换期间。<br>NT标志可以被任何权限级别的软件所修改。一个程序有可能在设置NT标志的同时执行IRET指令。这可能会随机地调用当前任务的TSS的前一个链接字段中指定的任务。为了防止这种虚假的任务切换成功，操作系统应该把它所创建的每个TSS中的前一个任务链接字段初始化为0。</p>
<p><img src="/2022/04/14/%E4%BB%BB%E5%8A%A1%E7%AE%A1%E7%90%86/image-20220415162023949.png" alt="image-20220415162023949"></p>
<h3 id="使用繁忙标志来防止递归任务的切换"><a href="#使用繁忙标志来防止递归任务的切换" class="headerlink" title="使用繁忙标志来防止递归任务的切换"></a>使用繁忙标志来防止递归任务的切换</h3><p>一个TSS只允许为一个任务保存一个上下文；因此，一旦一个任务被调用（派发），对任务的递归（或重入）调用该任务将导致该任务的当前状态丢失。TSS段中的繁忙标志 是为了防止重入式任务切换和随后的任务状态信息的丢失。处理器对繁忙标志的管理如下 ：</p>
<ol>
<li>当调度一个任务时，处理器设置新任务的繁忙标志。</li>
<li>如果在任务切换过程中，当前任务被放置在一个嵌套链中（任务切换是由一个CALL指令、一个中断或异常产生的），那么新任务的繁忙标志将被设置。</li>
<li>当切换到新的任务时（由CALL指令、中断或异常启动），处理器产生一个一般保护异常。如果新任务的繁忙标志已经被设置，处理器会产生一个一般保护的异常（#GP）。如果任务切换是由IRET指令发起的，那么异常就不会产生，因为处理器希望繁忙标志被设置。</li>
<li>当一个任务被跳转到一个新的任务（由任务代码中的JMP指令发起）或由任务代码中的IRET指令终止时，将产生一个异常。任务代码中的IRET指令终止时，处理器会清除繁忙标志，使任务回到 “不忙 “状态。</li>
</ol>
<p>处理器通过防止一个任务切换到它自己或一个嵌套的任务链中的任何任务来防止递归任务切换。由于多个调用、中断或异常，嵌套的暂停任务链可能增长到任何长度。如果一个任务在这个链中，忙碌标志会阻止它被调用。繁忙标志可以在多处理器配置中使用，因为处理器遵循一个LOCK协议（在总线上或缓存中），当它设置或清除繁忙标志时。这个锁使两个处理器不会同时调用同一个任务。</p>
<h3 id="修改任务链"><a href="#修改任务链" class="headerlink" title="修改任务链"></a>修改任务链</h3><p>在单处理器系统中，如果有必要从链接的任务链中删除一个任务，请使用以下程序来删除<br>使用以下程序来删除任务。</p>
<ol>
<li>禁用中断。</li>
<li>改变抢占式任务（暂停要删除的任务的任务）的TSS中的前一个任务链接字段。假设抢占式任务是要删除的任务链中的下一个任务（较新的任务）。改变前一个任务的链接字段，使其指向链中下一个最老的任务的TSS，或者指向链中更老的任务。</li>
<li>清除被删除的任务的TSS段描述符中的繁忙（B）标志。如果有一个以上的任务被从链上删除，必须清除每个被删除的任务的繁忙标志。</li>
<li>启用中断。</li>
</ol>
<p>在多进程系统中，必须在此过程中增加同步和序列化操作，以确保在改变前一个任务链接字段时，TSS和它的段描述符都被锁定并且繁忙标志被清除。</p>
<h2 id="任务地址空间"><a href="#任务地址空间" class="headerlink" title="任务地址空间"></a>任务地址空间</h2><p>一个任务的地址空间由该任务可以访问的段组成。这些段包括代码、数据、堆栈和在TSS中引用的系统段以及任务代码所访问的任何其他段。这些段被映射到处理器的线性地址空间，而线性地址空间又被映射到处理器的物理地址空间（直接或通过分页）。<br>TSS中的LDT段字段可以用来给每个任务提供它自己的LDT。给予一个任务它自己的LDT允许任务地址空间与其他任务隔离，将与该任务相关的所有段描述符放在该任务的LDT中。也可以让几个任务使用同一个LDT。这是一种节省内存的方式，允许特定的任务互相通信或控制，而不丢掉整个系统的保护屏障。因为所有的任务都可以访问GDT，所以也有可能创建共享段，通过该表的段描述符来访问。<br>如果分页功能被启用，TSS中的CR3寄存器（PDBR）字段允许每个任务有自己的一套页表，用于将线性地址映射到物理地址。或者，几个任务可以共享同一组页表。</p>
<h3 id="将任务映射到线性和物理地址空间"><a href="#将任务映射到线性和物理地址空间" class="headerlink" title="将任务映射到线性和物理地址空间"></a>将任务映射到线性和物理地址空间</h3><p>任务可以通过两种方式之一被映射到线性地址空间和物理地址空间。</p>
<ul>
<li>一个线性到物理地址空间的映射在所有任务之间共享。- 当分页未被启用时，这是唯一的选择。没有分页，所有线性地址都映射到相同的物理地址。当启用时，这种形式的线性到物理地址空间映射是通过为所有任务使用一个页目录来获得。如果支持需求分页，线性地址空间可能超过可用的物理空间。</li>
<li>每个任务都有自己的线性地址空间，被映射到物理地址空间。- 这种形式的映射是通过为每个任务使用不同的页面目录来完成的。因为PDBR（控制寄存器CR3）被加载到任务开关上，每个任务可能有一个不同的页面目录。</li>
</ul>
<p>不同任务的线性地址空间可能映射到完全不同的物理地址。如果不同页面目录的条目 指向不同的页表，而页表指向内存的不同页面，那么这些任务就不会共享物理地址。<br>无论采用哪种方法来映射任务的线性地址空间，所有任务的TSS必须位于物理空间的一个共享区域，这个区域是所有任务都可以访问的。这种映射是必需的，当处理器在任务切换过程中读取和更新TSSs时不会改变。线性地址空间也应该被映射到物理空间的一个共享区域；否则，GDT的目的就会落空。<br>图7-9显示了两个任务的线性地址空间是如何通过共享页表可在物理空间中重叠通过共享页表。</p>
<p><img src="/2022/04/14/%E4%BB%BB%E5%8A%A1%E7%AE%A1%E7%90%86/image-20220415163751118.png" alt="image-20220415163751118"></p>
<h3 id="任务逻辑地址空间"><a href="#任务逻辑地址空间" class="headerlink" title="任务逻辑地址空间"></a>任务逻辑地址空间</h3><p>为了允许任务之间共享数据，使用以下技术为数据段创建共享的逻辑-物理地址空间映射。</p>
<ul>
<li><strong>通过GDT中的段描述符</strong> - 所有任务必须能够访问GDT中的段描述符。如果GDT中的一些段描述符指向线性地址空间中的段，这些段被映射到所有任务共有的物理地址空间的一个区域，那么所有任务都可以共享这些段的数据和代码。</li>
<li><strong>通过一个共享的LDT</strong> - 如果两个或更多的任务的TSSs中的LDT字段指向同一个LDT，那么它们可以使用同一个LDT。如果共享LDT中的一些段描述符指向被映射到物理地址空间的一个共同区域的段 ，这些段的数据和代码可以在共享LDT的任务之间共享。这种共享方法比通过GDT共享更具选择性，因为共享可以被限制在特定的任务中。系统中的其他任务可能有不同的LDT，不允许他们访问共享段。</li>
<li><strong>通过不同的LDT中的段描述符，这些描述符被映射到线性空间的公共地址上</strong> -如果这个线性地址空间的公共区域被映射到每个任务的物理地址空间的相同区域，这些段描述符允许任务共享段。这种段描述符 通常被称为别名。这种共享方法比上面列出的方法更具有选择性。因为，LDT中的其他段描述符可能指向独立的线性地址，而这些段描述符并没有被共享。</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">51</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
          load: ['[tex]/mhchem'],
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
          packages: {'[+]': ['mhchem']},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
